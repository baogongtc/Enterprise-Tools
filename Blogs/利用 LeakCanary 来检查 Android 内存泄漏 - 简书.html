<!DOCTYPE html>
<!-- saved from url=(0037)http://www.jianshu.com/p/0049e9b344b0 -->
<html class=" js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="description" content="前言你被概率性的OOM困扰么？有时候，OOM像幽灵一样，挥之不去，可真想把它揪出来时，又捉之不着。或许，是时候用LeakCanary来诊断一下了。它是一个用来检查Android下内存泄漏的开源库，这篇文章主要介绍其用法、架构和其背后的实现原理。Square有篇文章介绍了开发这个库的原因。他们的一个付款流程里，需要用到用户的签名，他们直接用Bitmap来画签名，Bitmap大小和屏幕分辨率是一样的。问题来了，在试图创建这个Bitmap对象时，概率性OOM如幽灵般相随。他们试了几个方法：使用Bitmap.Config.ALPHA...">
  <meta property="wb:webmaster" content="294ec9de89e7fadb">
  <meta property="qc:admins" content="104102651453316562112116375">
  <meta property="qc:admins" content="11635613706305617">
  <meta property="qc:admins" content="1163561616621163056375">
  <meta name="google-site-verification" content="cV4-qkUJZR6gmFeajx_UyPe47GW9vY6cnCrYtCHYNh4">
  <meta name="google-site-verification" content="HF7lfF8YEGs1qtCE-kPml8Z469e2RHhGajy6JPVy5XI">
  <meta http-equiv="mobile-agent" content="format=html5; url=http://www.jianshu.com/p/0049e9b344b0">
    <!--  Meta for Smart App Banner -->
  <meta name="apple-itunes-app" content="app-id=888237539, app-argument=jianshu://notes/1417901">
  <!-- End -->

  <!--  Meta for Twitter Card -->
  <meta content="summary" property="twitter:card">
  <meta content="@jianshucom" property="twitter:site">
  <meta content="利用 LeakCanary 来检查 Android 内存泄漏" property="twitter:title">
  <meta content="前言你被概率性的OOM困扰么？有时候，OOM像幽灵一样，挥之不去，可真想把它揪出来时，又捉之不着。或许，是时候用LeakCanary来诊断一下了。它是一个用来检查Android下内存泄漏的开源库，这篇文章主要介绍其用法、架构和其背后的实现原理。Square有篇文章介绍了开发这个库的原因。他们的一个付款流程里，需要用到用户的签名，他们直接用Bitmap来画签名，Bitmap大小和屏幕分辨率是一样的。问题来了，在试图创建这个Bitmap对象时，概率性OOM如幽灵般相随。他们试了几个方法：使用Bitmap.Config.ALPHA..." property="twitter:description">
  <meta content="http://www.jianshu.com/p/0049e9b344b0" property="twitter:url">
  <!-- End -->

  <!--  Meta for OpenGraph -->
  <meta property="fb:app_id" content="865829053512461">
  <meta property="og:site_name" content="简书">
  <meta property="og:title" content="利用 LeakCanary 来检查 Android 内存泄漏">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://www.jianshu.com/p/0049e9b344b0">
  <meta property="og:description" content="前言你被概率性的OOM困扰么？有时候，OOM像幽灵一样，挥之不去，可真想把它揪出来时，又捉之不着。或许，是时候用LeakCanary来诊断一下了。它是一个用来检查Android下内存泄漏的开源库...">

  <!-- End -->

  <!--  Meta for Facebook Applinks -->
  <meta property="al:ios:url" content="jianshu://notes/1417901">
  <meta property="al:ios:app_store_id" content="888237539">
  <meta property="al:ios:app_name" content="简书">

  <meta property="al:android:url" content="jianshu://notes/1417901">
  <meta property="al:android:package" content="com.jianshu.haruki">
  <meta property="al:android:app_name" content="简书">
  <!-- End -->

  <title>利用 LeakCanary 来检查 Android 内存泄漏 - 简书</title>
  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="Bd1lep/xKaukE3RnzrjcTmtBXyLu24olOjlzK/EH8IokRQGv4ct3Mi7kPBiy311royNXEZrHz+0HhYG/P+vKOQ==">
  <!--[if lte IE 8]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="stylesheet" media="all" href="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/base-f935477e8faba16f29c6f9e4f0e1d032.css">

    <link rel="stylesheet" media="all" href="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/reading-note-4158a6eeb7c4e4a9fd15332778cfb52c.css">
  <link rel="stylesheet" media="all" href="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/base-read-mode-64acccf6966299cfa3d580140a2582fe.css">
  <script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/push.js"></script><script type="text/javascript" async="" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/ga.js"></script><script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/hm.js"></script><script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/modernizr-613ea63b5aa2f0e2a1946e9c28c8eedb.js"></script>
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if IE 8]><link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/scaffolding/for_ie-7f1c477ffedc13c11315103e8787dc6c.css" /><![endif]-->
  <!--[if lt IE 9]><link rel="stylesheet" media="all" href="http://cdn-qn0.jianshu.io/assets/scaffolding/for_ie-7f1c477ffedc13c11315103e8787dc6c.css" /><![endif]-->
  <link href="http://baijii-common.b0.upaiyun.com/icons/favicon.ico" rel="icon">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/57-b426758a1fcfb30486f20fd073c3b8ec.png" sizes="57x57">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/72-feca4b183b9d29fd188665785dc7a7f1.png" sizes="72x72">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/76-ba757f1ad3421192ce7192170393d2b0.png" sizes="76x76">
      <link rel="apple-touch-icon-precomposed" href="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/114-8dae53b3bcea3f06bb139e329d1edab3.png" sizes="114x114">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/120-fa315ee0177dba4c55d4f66d4129b47f.png" sizes="120x120">
      <link rel="apple-touch-icon-precomposed" href="http://cdn-qn0.jianshu.io/assets/apple-touch-icons/152-052f5799bec8fb3aa624bdc72ef5bd1d.png" sizes="152x152">
  <!-- Baidu stats -->
  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?0c0e9d9b1e7d617b3e6842e85b9fb068";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
<style type="text/css"></style></head>

<body class="post output zh cn win reader-day-mode reader-font2" data-js-module="note-show" data-locale="zh-CN" data-pinterest-extension-installed="cr1.39.1">
  
  <div class="navbar navbar-jianshu shrink hide-wrap-btn">
  <div class="dropdown">
    <a class="dropdown-toggle logo" id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="javascript:void(0)">
      简
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
      <li><a href="http://www.jianshu.com/"><i class="fa fa-home"></i> 首页</a></li>
      <li><a href="http://www.jianshu.com/collections"><i class="fa fa-th"></i> 专题</a></li>
      <li><a href="http://www.jianshu.com/user_invitations"><i class="fa fa-money"></i> 发钱啦</a></li>
    </ul>
  </div>
</div>
<div class="navbar-user">
    <a class="login" data-signup-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_up">
      <i class="fa fa-user"></i> 注册
</a>    <a class="login" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
      <i class="fa fa-sign-in"></i> 登录
</a>    <a class="daytime set-view-mode pull-right" href="javascript:void(0)"><i class="fa fa-moon-o"></i></a>
</div>
<div class="navbar navbar-jianshu expanded">
  <div class="dropdown">
      <a class="active logo" role="button" data-original-title="个人主页" data-container="div.expanded" href="http://www.jianshu.com/">
        <b>简</b><i class="fa fa-home"></i><span class="title">首页</span>
</a>      <a data-toggle="tooltip" data-placement="right" data-original-title="专题" data-container="div.expanded" href="http://www.jianshu.com/collections">
        <i class="fa fa-th"></i><span class="title">专题</span>
</a>    <a class="ad-selector" href="http://www.jianshu.com/apps">
      <i class="fa fa-mobile"></i><span class="title">下载手机应用</span>
</a>    <div class="ad-container ">
      <div class="ad-pop">
        <img class="ad-logo" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/114-8dae53b3bcea3f06bb139e329d1edab3.png" alt="114">
        <p class="ad-title">简书</p>
        <p class="ad-subtitle">交流故事，沟通想法</p>
        <img class="ad-qrcode" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/download-app-qrcode-053849fa25f9b44573ef8dd3c118a20f.png" alt="Download app qrcode">
        <div>
          <a class="ad-link" href="https://itunes.apple.com/cn/app/jian-shu/id888237539?ls=1&amp;mt=8">iOS</a>·
          <a class="ad-link" href="http://downloads.jianshu.io/apps/haruki/JianShu-1.11.1.apk">Android</a>
        </div>
      </div> 
    </div>
  </div>
  <div class="nav-user">
      <a href="http://www.jianshu.com/p/0049e9b344b0#view-mode-modal" data-toggle="modal"><i class="fa fa-font"></i><span class="title">显示模式</span></a>

      <a class="signin" data-signin-link="true" data-toggle="modal" data-placement="right" data-original-title="登录" data-container="div.expanded" href="http://www.jianshu.com/sign_in">
        <i class="fa fa-sign-in"></i><span class="title">登录</span>
</a>    </div>
  </div>

  
    <div class="fixed-btn">
    <a class="go-top" href="http://www.jianshu.com/p/0049e9b344b0#"> <i class="fa fa-angle-up"></i></a>
    <a class="qrcode" data-target="#bottom-qrcode" data-toggle="modal" href="javascript:void(0)"><i class="fa fa-qrcode"></i></a>
    <a class="writer" href="http://www.jianshu.com/writer#/" data-toggle="tooltip" data-placement="left" title="" data-original-title="写篇文章"><i class="fa fa-pencil"></i></a>
    <!-- qrcode modal -->
    <div id="bottom-qrcode" class="modal panel-modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
      <h4>下载简书移动应用</h4>
      <div class="panel-body"><img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/download-app-qrcode-85008f146773a25ce86bcc4d7858af68.png" alt="Download app qrcode"></div>
    </div>
  </div>


  <div id="show-note-container" class="imagebubble-container imagebubble-mode-off">
    
<div class="post-bg" id="flag">
  <div class="wrap-btn hide-wrap-btn" style="top: -1px;">
    <!-- Notebook and collections button upper left -->
      <div class="article-related pull-left">
          <a class="collection-menu-btn" data-toggle="modal" data-target="#collection-menu" href="javascript:void(null);">
            <i class="fa fa-th"></i>
</a>          <a class="notebooks-menu-btn" data-toggle="modal" data-target="#notebooks-menu" href="javascript:void(null);"><i class="fa fa-list-ul"></i></a>
        <div class="related-avatar-group activities"></div>
      </div>
    <!-- ******* -->

      <a class="login" data-signup-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_up">
    <i class="fa fa-user"></i> 注册
</a>  <a class="login" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
    <i class="fa fa-sign-in"></i> 登录
</a>

    <!-- Buttons upper right -->
    <!-- ******* -->
  </div>

  <div class="container">
    <!-- Article activities for width under 768px -->
    <div class="related-avatar-group activities"></div>
      <div class="article">
        <div class="preview">
          <div class="author-info">
              <div class="btn btn-small btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in"><i class="fa fa-plus"></i>  <span>添加关注</span></a>
  </div>

            <a class="avatar" href="http://www.jianshu.com/users/3718163e49e5">
              <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/7862ae8c3843.jpg" alt="100">
</a>            <span class="label">
                作者
            </span>
            <a class="author-name blue-link" href="http://www.jianshu.com/users/3718163e49e5">
              <span>kamidox</span>
</a>              <span data-toggle="tooltip" data-original-title="最后编辑于 2016.01.03 16:46">2015.05.12 22:23*</span>
            <div>
              <span>写了74792字</span>，<span>被536人关注</span>，<span>获得了1292个喜欢</span>
            </div>
          </div>
          <h1 class="title">利用 LeakCanary 来检查 Android 内存泄漏</h1>
          <div class="meta-top">
            <span class="wordage">字数1769</span>
            <span class="views-count">阅读7724</span>
            <span class="comments-count">评论7</span>
            <span class="likes-count">喜欢19</span>
          </div>

          <!-- Collection/Bookmark/Share for width under 768px -->
          <div class="article-share"><a class="bookmark" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in"> <i class="fa fa-bookmark-o"></i><span>收藏文章</span></a><span> <a href="javascript:void(null)" data-toggle="dropdown"><i class="fa fa-share-square-o"></i> 分享</a> <ul class="dropdown-menu arrow-top"> <li> <a href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f=&#39;http://v.t.sina.com.cn/share/share.php?appkey=1881139527&#39;,u=z||d.location,p=[&#39;&amp;url=&#39;,e(u),&#39;&amp;title=&#39;,e(t||d.title),&#39;&amp;source=&#39;,e(r),&#39;&amp;sourceUrl=&#39;,e(l),&#39;&amp;content=&#39;,c||&#39;gb2312&#39;,&#39;&amp;pic=&#39;,e(p||&#39;&#39;)].join(&#39;&#39;);function%20a(){if(!window.open([f,p].join(&#39;&#39;),&#39;mb&#39;,[&#39;toolbar=0,status=0,resizable=1,width=440,height=430,left=&#39;,(s.width-440)/2,&#39;,top=&#39;,(s.height-430)/2].join(&#39;&#39;)))u.href=[f,p].join(&#39;&#39;);};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,&#39;&#39;,&#39;&#39;,&#39;http://cwb.assets.jianshu.io/notes/images/1417901/weibo/image_c78190044919.jpg&#39;, &#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @简书 ）&#39;,&#39;http://www.jianshu.com/p/0049e9b344b0&#39;,&#39;页面编码gb2312|utf-8默认gb2312&#39;));"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/weibo.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:&#39;&#39;,r=&#39;http://www.douban.com/recommend/?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;利用 LeakCanary 来检查 Android 内存泄漏&#39;)+&#39;&amp;sel=&#39;+e(s)+&#39;&amp;v=1&#39;,x=function(){if(!window.open(r,&#39;douban&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r+&#39;&amp;r=1&#39;};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/douban.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @jianshuio ）&#39;),x=function(){if(!window.open(r,&#39;tweibo&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/tweibo.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》&#39;),x=function(){if(!window.open(r,&#39;qzone&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/qzone.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://twitter.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;text=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @jianshucom ）&#39;)+&#39;&amp;related=&#39;+e(&#39;jianshucom&#39;),x=function(){if(!window.open(r,&#39;twitter&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/twitter.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/0049e9b344b0&#39;,x=function(){if(!window.open(r,&#39;facebook&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/facebook.png"> </a> </li> <li> <a href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://plus.google.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;),x=function(){if(!window.open(r,&#39;google_plus&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/google_plus.png"> </a> </li> <li> <a href="http://www.jianshu.com/p/0049e9b344b0"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/renren.png"> </a> </li> </ul></span></div>
          <!-- -->

          <div class="show-content"><h3>前言</h3>
<p>你被概率性的 OOM 困扰么？有时候，OOM 像幽灵一样，挥之不去，可真想把它揪出来时，又捉之不着。或许，是时候用 <a href="https://github.com/square/leakcanary" target="_blank">LeakCanary</a> 来诊断一下了。它是一个用来检查 Android 下内存泄漏的开源库，这篇文章主要介绍其用法、架构和其背后的实现原理。</p>
<p>Square <a href="https://corner.squareup.com/2015/05/leak-canary.html" target="_blank">有篇文章</a>介绍了开发这个库的原因。他们的一个付款流程里，需要用到用户的签名，他们直接用 Bitmap 来画签名，Bitmap 大小和屏幕分辨率是一样的。问题来了，在试图创建这个 Bitmap 对象时，概率性 OOM 如幽灵般相随。他们试了几个方法：</p>
<ul>
<li>使用 <code>Bitmap.Config.ALPHA_8</code> 来节省内存</li>
<li>捕获 <code>OutOfMemoryError</code> 异常，调用 gc 清理内存，然后重试几次</li>
</ul>
<p>最终这些都不起作用。最终他们发现他们在错误的方向上走得太远了。当存在<strong>内存泄漏</strong>时，可用内存越来越少，这个时候 OOM 可以发生在任何地方，特别是试图创建一些大内存对象，如 Bitmap 的时候。</p>
<p>我们在上一篇文章<a href="http://blog.kamidox.com/android-memory-guide.html" target="_blank">《Android 内存与性能》</a>里介绍了使用 <a href="http://www.eclipse.org/mat/downloads.php" target="_blank">MAT</a> 来分析内存泄漏的方法。概括起来核心步骤是：</p>
<ul>
<li>发生 OOM 或做一些可能存在内存泄漏的操作后，导出 HPROF 文件</li>
<li>利用 MAT 结合代码分析，来发现一些引用异常，比如哪些对象本来应该被回收的，却还在系统堆中，那么它就是内存泄漏</li>
</ul>
<p><strong>如果有一个工具能自动完成这些事情，甚至在发生 OOM 之前，就把内存泄漏报告给你，那是多么美好的一件事情啊。</strong>LeakCanary 就是用来干这个事情的。在测试你的 App 时，如果发生了内存泄漏，状态栏上会有通知告诉你。logcat 上也会有相应的 log 通知你。</p>
<p>!!! notes "启发"<br>    LeakCanary 产生的背后有几个有意思的启发。一是像 Square 这样公司一样会被 OOM 这种问题困扰；二是他们也会犯错，试了几种方法都不起作用；三是他们最终用一个优雅的方式解决了这个问题，并且通过开源库的方式让所有人共享他们的工作成果。</p>
<h3>用法</h3>
<h4>监控 Activity 泄露</h4>
<p>我们经常把 Activity 当作为 Context 对象使用，在不同场合由各种对象引用 Activity。所以，Activity 泄漏是一个重要的需要检查的内存泄漏之一。</p>
<pre class="hljs java"><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RefWatcher <span class="hljs-title">getRefWatcher</span><span class="hljs-params">(Context context)</span> </span>{
        ExampleApplication application = (ExampleApplication) context.getApplicationContext();
        <span class="hljs-keyword">return</span> application.refWatcher;
    }

    <span class="hljs-keyword">private</span> RefWatcher refWatcher;

    <span class="hljs-annotation">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate();
        refWatcher = LeakCanary.install(<span class="hljs-keyword">this</span>);
    }
}</code></pre>
<p><code>LeakCanary.install()</code> 返回一个配置好了的 <code>RefWatcher</code> 实例。它同时安装了 <code>ActivityRefWatcher</code> 来监控 Activity 泄漏。即当 <code>Activity.onDestroy()</code> 被调用之后，如果这个 Activity 没有被销毁，logcat 就会打印出如下信息告诉你内存泄漏发生了。</p>
<pre class="hljs scala"><code class="scala">    * com.example.leakcanary.<span class="hljs-type">MainActivity</span> has leaked:
    * <span class="hljs-type">GC</span> <span class="hljs-type">ROOT</span> thread java.lang.<span class="hljs-type">Thread</span>.&lt;<span class="hljs-type">Java</span> <span class="hljs-type">Local</span>&gt; (named <span class="hljs-symbol">'AsyncTask</span> #<span class="hljs-number">1</span>')
    * references com.example.leakcanary.<span class="hljs-type">MainActivity</span>$<span class="hljs-number">2.</span><span class="hljs-keyword">this</span>$<span class="hljs-number">0</span> (anonymous <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">android</span>.<span class="hljs-title">os</span>.<span class="hljs-title">AsyncTask</span>)
</span>    * leaks com.example.leakcanary.<span class="hljs-type">MainActivity</span> instance
    * <span class="hljs-type">Reference</span> <span class="hljs-type">Key</span>: c4d32914-<span class="hljs-number">618</span>d-<span class="hljs-number">4</span>caf-<span class="hljs-number">993</span>b-<span class="hljs-number">4</span>b835c255873
    * <span class="hljs-type">Device</span>: <span class="hljs-type">Genymotion</span> generic <span class="hljs-type">Google</span> <span class="hljs-type">Galaxy</span> <span class="hljs-type">Nexus</span> - <span class="hljs-number">4.2</span><span class="hljs-number">.2</span> - <span class="hljs-type">API</span> <span class="hljs-number">17</span> - <span class="hljs-number">720</span>x1280 vbox86p
    * <span class="hljs-type">Android</span> <span class="hljs-type">Version</span>: <span class="hljs-number">4.2</span><span class="hljs-number">.2</span> <span class="hljs-type">API</span>: <span class="hljs-number">17</span>
    * <span class="hljs-type">Durations</span>: watch=<span class="hljs-number">5100</span>ms, gc=<span class="hljs-number">104</span>ms, heap dump=<span class="hljs-number">82</span>ms, analysis=<span class="hljs-number">3008</span>ms</code></pre>
<p>!!! notes<br>    LeakCanary 自动检测 Activity 泄漏只支持 Android ICS 以上版本。因为 <code>Application.registerActivityLifecycleCallbacks()</code> 是在 API 14 引入的。如果要在 ICS 之前监测 Activity 泄漏，可以重载 <code>Activity.onDestroy()</code> 方法，然后在这个方法里调用 <code>RefWatcher.watch(this)</code> 来实现。</p>
<h4>监控 Fragment 泄漏</h4>
<pre class="hljs java"><code class="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Fragment</span> </span>{

    <span class="hljs-annotation">@Override</span> 
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onDestroy();
        RefWatcher refWatcher = ExampleApplication.getRefWatcher(getActivity());
        refWatcher.watch(<span class="hljs-keyword">this</span>);
    }
}</code></pre>
<p>当 <code>Fragment.onDestroy()</code> 被调用之后，如果这个 fragment 实例没有被销毁，那么就会从 logcat 里看到相应的泄漏信息。</p>
<h4>监控其他泄漏</h4>
<pre class="hljs java"><code class="java">    ...
    RefWatcher refWatcher = ExampleApplication.getRefWatcher(getActivity());
    refWatcher.watch(someObjNeedGced);</code></pre>
<p>当 <code>someObjNeedGced</code> 还在内存中时，就会在 logcat 里看到内存泄漏的提示。</p>
<h4>集成 LeakCanary 库</h4>
<pre class="hljs bash"><code class="bash">dependencies {
    debugCompile <span class="hljs-string">'com.squareup.leakcanary:leakcanary-android:1.3'</span>
    releaseCompile <span class="hljs-string">'com.squareup.leakcanary:leakcanary-android-no-op:1.3'</span>
}</code></pre>
<p>在 debug 版本上，集成 LeakCanary 库，并执行内存泄漏监测，而在 release 版本上，集成一个无操作的 wrapper ，这样对程序性能就不会有影响。</p>
<h3>原理</h3>
<h4>LeakCanary 流程图</h4>
<div class="image-package imagebubble" widget="ImageBubble">
<img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/leakcanary.png" data-original-src="https://raw.githubusercontent.com/kamidox/blogs/master/images/leakcanary.png" class="imagebubble-image"><br><div class="image-caption">leakcanary</div>
</div>
<p>LeakCanary 的机制如下：</p>
<ol>
<li>
<code>RefWatcher.watch()</code> 会以监控对象来创建一个 <code>KeyedWeakReference</code> 弱引用对象</li>
<li>在 <code>AndroidWatchExecutor</code> 的后台线程里，来检查弱引用已经被清除了，如果没被清除，则执行一次 GC</li>
<li>如果弱引用对象仍然没有被清除，说明内存泄漏了，系统就导出 hprof 文件，保存在 app 的文件系统目录下</li>
<li>
<code>HeapAnalyzerService</code> 启动一个单独的进程，使用 <code>HeapAnalyzer</code> 来分析 hprof 文件。它使用另外一个开源库 <a href="https://github.com/square/haha" target="_blank">HAHA</a>。</li>
<li>
<code>HeapAnalyzer</code> 通过查找 <code>KeyedWeakReference</code> 弱引用对象来查找内在泄漏</li>
<li>
<code>HeapAnalyzer</code> 计算 <code>KeyedWeakReference</code> 所引用对象的最短强引用路径，来分析内存泄漏，并且构建出对象引用链出来。</li>
<li>内存泄漏信息送回给 <code>DisplayLeakService</code>，它是运行在 app 进程里的一个服务。然后在设备通知栏显示内存泄漏信息。</li>
</ol>
<h4>几个有意思的代码</h4>
<p><strong>如何导出 hprof 文件</strong></p>
<pre class="hljs java"><code class="java">File heapDumpFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"heapdump.hprof"</span>);
Debug.dumpHprofData(heapDumpFile.getAbsolutePath());</code></pre>
<p>可以参阅 <a href="https://github.com/square/leakcanary/blob/master/library/leakcanary-android/src/main/java/com/squareup/leakcanary/AndroidHeapDumper.java" target="_blank">AndroidHeapDumper.java</a> 的代码。</p>
<p><strong>如何分析 hprof 文件</strong></p>
<p>这是个比较大的话题，感兴趣的可以移步另外一个开源库 <a href="https://github.com/square/haha" target="_blank">HAHA</a>，它的祖先是 <a href="http://www.eclipse.org/mat/downloads.php" target="_blank">MAT</a>。</p>
<p><strong>如何使用 HandlerThread</strong></p>
<p>可以参阅 <a href="https://github.com/square/leakcanary/blob/master/library/leakcanary-android/src/main/java/com/squareup/leakcanary/AndroidWatchExecutor.java" target="_blank">AndroidWatchExecutor.java</a>的代码，特别是关于 Handler, Loop 的使用。</p>
<p><strong>怎么知道某个变量已经被 GC 回收</strong></p>
<p>可以参阅 <a href="http://www.plantuml.com/" target="_blank">RefWatcher.java</a> 的 <code>ensureGone()</code> 函数。最主要是利用 <code>WeakReference</code> 和 <code>ReferenceQueue</code> 机制。简单地讲，就是当弱引用 <code>WeakReference</code> 所引用的对象被回收后，这个 <code>WeakReference</code> 对象就会被添加到 <code>ReferenceQueue</code> 队列里，我们可以通过其 <code>poll()</code> 方法获取到这个被回收的对象的 <code>WeakReference</code> 实例，进而知道需要监控的对象是否被回收了。</p>
<h3>关于内存泄漏</h3>
<p>内存泄漏可能很容易发现，比如 Cursor 没关闭；比如在 <code>Activity.onResume()</code> 里 register 了某个需要监听的事件，但在 <code>Activity.onPause()</code> 里忘记 unregister 了；内存泄漏也可能很难发现，比如 <a href="https://github.com/square/leakcanary/blob/master/library/leakcanary-sample/src/main/java/com/example/leakcanary/MainActivity.java" target="_blank">LeakCanary 示例代码</a>，隐含地引用，并且只有在旋转屏幕时才会发生。还有更难发现，甚至无能为力的内存泄漏，比如 Android SDK 本身的 BUG 导致内存泄漏。<a href="https://github.com/square/leakcanary/blob/master/library/leakcanary-android/src/main/java/com/squareup/leakcanary/AndroidExcludedRefs.java" target="_blank">AndroidExcludedRefs.java</a> 里就记录了一些己知的 AOSP 版本的以及其 OEM 实现版本里存在的内存泄漏。</p>
<h3>本期推荐</h3>
<p>推荐一个画图工具 <a href="http://www.plantuml.com/" target="_blank">planUML</a>，其最大的特色是使用脚本来画图。它和 <a href="http://staruml.io/" target="_blank">starUML</a> 的最大区别是，前者是画图工具，类似于微软的 visio，而且支持脚本画图，后者是建模工具。<a href="http://www.plantuml.com/PlantUML_Language_Reference_Guide.pdf" target="_blank">这里</a>是 planUML 的官方文档。它还支持一堆<a href="http://www.plantuml.com/running.html" target="_blank">扩展</a>，比如 <a href="https://github.com/jvantuyl/sublime_diagram_plugin" target="_blank">Sublime Text</a>等。本文的<a href="https://raw.githubusercontent.com/kamidox/blogs/master/images/leakcanary.wsd" target="_blank">流程图</a>就是用 planUML 画的。</p>
</div>
        </div>
      </div>

      <div class="visitor_edit">
        <!-- further readings -->
        <div id="further-readings" data-user-slug="" data-user-nickname="">
          <div id="further-reading-line" class="hide further-reading-line"></div>
          <ul id="further-readings-list" class="reading-list unstyled"></ul>
          <div id="further-reading-new" class="reading-edit">
              <a data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
                <i class="fa fa-plus-circle"></i> 推荐拓展阅读
</a>            <div id="further-reading-form"></div>
          </div>
        </div>
        <div class="pull-right">
          <!-- copyright -->
          <div class="author-copyright pull-right" data-toggle="tooltip" data-html="true" title="" data-original-title="转载请联系作者获得授权，并标注“简书作者”。">
            <a><i class="fa fa-copyright"></i> 著作权归作者所有</a>
          </div>
        </div>
      </div>

      <!-- Reward / Support Author -->
        <div class="support-author">
          <p>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</p>
            <a class="btn btn-pay" data-toggle="modal" href="http://www.jianshu.com/p/0049e9b344b0#pay-modal">¥ 打赏支持</a>
          <div class="avatar-list"></div>
        </div>

      <!-- article meta bottom -->
      <div class="meta-bottom clearfix">
        <!--  Like Button -->
        <div class="like ">
            <div class="like-button">
              <a id="like-note" class="like-content" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
                <i class="fa fa-heart-o"></i>  喜欢
</a></div>          <span id="likes-count" data-toggle="tooltip" data-placement="right" title="" data-original-title="查看所有喜欢的用户">19</span>        </div>
        <!--  share group -->
        <div class="share-group pull-right">
          <a href="javascript:void((function(s,d,e,r,l,p,t,z,c){var%20f=&#39;http://v.t.sina.com.cn/share/share.php?appkey=1881139527&#39;,u=z||d.location,p=[&#39;&amp;url=&#39;,e(u),&#39;&amp;title=&#39;,e(t||d.title),&#39;&amp;source=&#39;,e(r),&#39;&amp;sourceUrl=&#39;,e(l),&#39;&amp;content=&#39;,c||&#39;gb2312&#39;,&#39;&amp;pic=&#39;,e(p||&#39;&#39;)].join(&#39;&#39;);function%20a(){if(!window.open([f,p].join(&#39;&#39;),&#39;mb&#39;,[&#39;toolbar=0,status=0,resizable=1,width=440,height=430,left=&#39;,(s.width-440)/2,&#39;,top=&#39;,(s.height-430)/2].join(&#39;&#39;)))u.href=[f,p].join(&#39;&#39;);};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,&#39;&#39;,&#39;&#39;,&#39;http://cwb.assets.jianshu.io/notes/images/1417901/weibo/image_c78190044919.jpg&#39;, &#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @简书 ）&#39;,&#39;http://www.jianshu.com/p/0049e9b344b0&#39;,&#39;页面编码gb2312|utf-8默认gb2312&#39;));" data-name="weibo">
            <i class="fa fa-weibo"></i><span>分享到微博</span>
          </a>
          <a data-toggle="modal" href="http://www.jianshu.com/p/0049e9b344b0#share-weixin-modal" data-name="weixin">
            <i class="fa fa-weixin"></i><span>分享到微信</span>
          </a>
          <div class="more">
            <a href="javascript:void(0)" data-toggle="dropdown">更多分享<i class="fa fa-caret-down"></i></a>
            <ul class="dropdown-menu arrow-top">
                <li><a href="http://cwb.assets.jianshu.io/notes/images/1417901/weibo/image_c78190044919.jpg" target="_blank" data-name="changweibo"><i class="fa fa-arrow-circle-o-down"></i> 下载长微博图片</a></li>
                <li>
                  <a data-name="tweibo" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://share.v.t.qq.com/index.php?c=share&amp;a=index&amp;url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @jianshuio ）&#39;),x=function(){if(!window.open(r,&#39;tweibo&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/tweibo.png" alt="Tweibo"> 分享到腾讯微博
</a>                </li>
                <li>
                  <a data-name="qzone" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》&#39;),x=function(){if(!window.open(r,&#39;qzone&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/qzone.png" alt="Qzone"> 分享到QQ空间
</a>                </li>
                <li>
                  <a data-name="twitter" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://twitter.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;text=&#39;+e(&#39;推荐 kamidox 的文章《利用 LeakCanary 来检查 Android 内存泄漏》（ 分享自 @jianshucom ）&#39;)+&#39;&amp;related=&#39;+e(&#39;jianshucom&#39;),x=function(){if(!window.open(r,&#39;twitter&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=600,height=600&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/twitter.png" alt="Twitter"> 分享到Twitter
</a>                </li>
                <li>
                  <a data-name="facebook" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://www.facebook.com/dialog/share?app_id=483126645039390&amp;display=popup&amp;href=http://www.jianshu.com/p/0049e9b344b0&#39;,x=function(){if(!window.open(r,&#39;facebook&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/facebook.png" alt="Facebook"> 分享到Facebook
</a>                </li>
                <li>
                  <a data-name="google_plus" href="javascript:void(function(){var d=document,e=encodeURIComponent,r=&#39;https://plus.google.com/share?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;),x=function(){if(!window.open(r,&#39;google_plus&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})();">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/google_plus.png" alt="Google plus"> 分享到Google+
</a>                </li>
                <li>
                  <a data-name="douban" href="javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:&#39;&#39;,r=&#39;http://www.douban.com/recommend/?url=&#39;+e(&#39;http://www.jianshu.com/p/0049e9b344b0&#39;)+&#39;&amp;title=&#39;+e(&#39;利用 LeakCanary 来检查 Android 内存泄漏&#39;)+&#39;&amp;sel=&#39;+e(s)+&#39;&amp;v=1&#39;,x=function(){if(!window.open(r,&#39;douban&#39;,&#39;toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330&#39;))location.href=r+&#39;&amp;r=1&#39;};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()">
                    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/douban.png" alt="Douban"> 分享到豆瓣
</a>                </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Modals -->
      <div id="share-weixin-modal" class="modal hide fade share-weixin-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <div class="modal-body" title="http://www.jianshu.com/p/0049e9b344b0?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=reader_share&amp;utm_source=weixin">
    <h5>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</h5>
  <canvas width="170" height="170" style="display: none;"></canvas><img src="data:image/png;base64,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" style="display: block;"></div>
</div>

      
      <div id="notebooks-menu" class="panel notebooks-menu arrow-top modal hide fade"><img class="loader-tiny" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/tiny.gif" alt="Tiny"></div>
      <div id="collection-menu" class="panel collection-menu arrow-top modal hide fade"><img class="loader-tiny" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/tiny.gif" alt="Tiny"></div>
      
      <div id="likes-modal" class="modal modal_new support_list-modal fullscreen hide fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3>喜欢的用户</h3>
      </div>
      <div class="modal-body">
        <ul class="unstyled users">
        <li data-user-id="1830629"> <a class="avatar" href="http://www.jianshu.com/users/4462f46ac380"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/b7040e8467a7"> </a> <a class="blue-link" href="http://www.jianshu.com/users/4462f46ac380">4462f46ac380</a> <span class="time">2016.06.28 14:58</span></li><li data-user-id="1875276"> <a class="avatar" href="http://www.jianshu.com/users/00c96d986ab6"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/6-c3a19bc117a55e66cd3be55684d8191c.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/00c96d986ab6">差得很远呢</a> <span class="time">2016.06.01 16:58</span></li><li data-user-id="2067615"> <a class="avatar" href="http://www.jianshu.com/users/488ad948cf54"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/6a200680bb46"> </a> <a class="blue-link" href="http://www.jianshu.com/users/488ad948cf54">zeal008</a> <span class="time">2016.05.26 17:43</span></li><li data-user-id="1182582"> <a class="avatar" href="http://www.jianshu.com/users/0b2dc1134e4f"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/976e312a2986.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/0b2dc1134e4f">尸情化异</a> <span class="time">2016.05.26 11:33</span></li><li data-user-id="1976558"> <a class="avatar" href="http://www.jianshu.com/users/14a583d7080d"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/f3cd460f0fb2"> </a> <a class="blue-link" href="http://www.jianshu.com/users/14a583d7080d">Loong口一你了亲并</a> <span class="time">2016.05.16 19:29</span></li><li data-user-id="1900942"> <a class="avatar" href="http://www.jianshu.com/users/a92c407527ff"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/0f0c93e02703"> </a> <a class="blue-link" href="http://www.jianshu.com/users/a92c407527ff">Niuin</a> <span class="time">2016.05.12 09:30</span></li><li data-user-id="1482477"> <a class="avatar" href="http://www.jianshu.com/users/47640f1bd419"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/6-c3a19bc117a55e66cd3be55684d8191c.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/47640f1bd419">TangKe</a> <span class="time">2016.04.11 00:58</span></li><li data-user-id="1053875"> <a class="avatar" href="http://www.jianshu.com/users/a5d1966d74eb"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/12-07a584b5038a24cbb23b81dc673c18fd.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/a5d1966d74eb">河畔的风</a> <span class="time">2016.03.29 14:42</span></li><li data-user-id="1336838"> <a class="avatar" href="http://www.jianshu.com/users/e46b2ee80312"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/102ef5fe4398"> </a> <a class="blue-link" href="http://www.jianshu.com/users/e46b2ee80312">苗守飞</a> <span class="time">2016.03.25 21:59</span></li><li data-user-id="1018039"> <a class="avatar" href="http://www.jianshu.com/users/470afcb80dc2"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/5fa8b6c050e0.jpeg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/470afcb80dc2">r17171709</a> <span class="time">2016.03.07 17:59</span></li><li data-user-id="266949"> <a class="avatar" href="http://www.jianshu.com/users/78552b4c87e8"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/7946a95de405"> </a> <a class="blue-link" href="http://www.jianshu.com/users/78552b4c87e8">马琳</a> <span class="time">2016.03.07 15:24</span></li><li data-user-id="701747"> <a class="avatar" href="http://www.jianshu.com/users/5eed728baf79"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/95b80982ce2f.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/5eed728baf79">F1ReKing</a> <span class="time">2016.02.16 01:43</span></li><li data-user-id="64900"> <a class="avatar" href="http://www.jianshu.com/users/75279446e7d8"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/8a3e23331aeb"> </a> <a class="blue-link" href="http://www.jianshu.com/users/75279446e7d8">一休的冥思苦想</a> <span class="time">2016.01.14 13:45</span></li><li data-user-id="525051"> <a class="avatar" href="http://www.jianshu.com/users/dcae98d4700d"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/12-07a584b5038a24cbb23b81dc673c18fd.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/dcae98d4700d">sing_song</a> <span class="time">2015.12.24 11:00</span></li><li data-user-id="124293"> <a class="avatar" href="http://www.jianshu.com/users/8bf1ef28ea8b"> <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/ac2a630fe8ff.jpg"> </a> <a class="blue-link" href="http://www.jianshu.com/users/8bf1ef28ea8b">stevenMvp</a> <span class="time">2015.09.22 01:28</span></li><a class="more hidden" data-max-id="7157235" href="javascript:void(null);"><i class="fa fa-ellipsis-h"></i></a></ul>
      </div>
    </div>
  </div>
</div>



    <!-- Comments -->
    <div id="comments" class="comment-list clearfix">
        <div class="comment-head clearfix">
          7条评论
          <span class="order">
            （
            <a data-order="asc" class="active" href="javascript:void(0)">按时间正序</a>·
            <a data-order="desc" href="javascript:void(0)">按时间倒序</a>·
            <a data-order="likes_count" href="javascript:void(0)">按喜欢排序</a>
            ）
          </span>
            <a class="goto-comment pull-right" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
              <i class="fa fa-pencil"></i>添加新评论
</a>        </div>
        <div id="comment-list"><script type="application/json" data-name="comments-info">
  {"comments":[{"id":314120,"children_count":0,"likes_count":0},{"id":318284,"children_count":0,"likes_count":0},{"id":318293,"children_count":1,"likes_count":0},{"id":893527,"children_count":0,"likes_count":0},{"id":1122366,"children_count":1,"likes_count":0}]}
</script>


<div class="note-comment clearfix" id="comment-314120">
  <div class="content">
      <div class="meta-top">
        <a class="avatar" href="http://www.jianshu.com/users/5f4b588e2526">
          <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/25aeda154962" alt="100">
</a>        <p>
          <a class="author-name" href="http://www.jianshu.com/users/5f4b588e2526">Hugetimor</a>
        </p>
        <span class="reply-time">
          <small>2 楼 · </small>
          <a href="http://www.jianshu.com/p/0049e9b344b0/comments/314120#comment-314120">2015.05.13 15:44</a></span>
      </div>
      <p>In me.zeyuan.competition:1.0:3.<br>* me.zeyuan.competition.ui.MainActivity has leaked:<br>* GC ROOT thread com.android.volley.NetworkDispatcher.&lt;Java Local&gt; (named 'Thread-12844')<br>* references com.android.volley.toolbox.StringRequest.mErrorListener<br>* references me.zeyuan.competition.ui.MainActivity$2.this$0 (anonymous class implements com.android.volley.Response$ErrorListener)<br>* leaks me.zeyuan.competition.ui.MainActivity instance<br><br>* Reference Key: 3d9ae3e2-b809-47bf-bae5-cf8688470cd7<br>* Device: Xiaomi Xiaomi MI 4W cancro_wc_lte<br>* Android Version: 4.4.4 API: 19<br>* Durations: watch=5022ms, gc=151ms, heap dump=966ms, analysis=14456ms<br><br>请这要怎么查找那里泄露了？</p>
      <div class="comment-footer clearfix text-right">
        <a data-id="314120" class="like pull-left" href="javascript:void(0)">
          <i class="fa fa-heart-o"></i>喜欢<span>(0)</span>
</a>        

        <a data-id="314120" data-nickname="Hugetimor" class="reply" href="javascript:void(0)">回复</a>
        
        
      </div>
    <div class="child-comment-list hide">
      
      <div data-state="remaining-child-comments"></div>
    </div>
  </div>
</div>

<div class="note-comment clearfix" id="comment-318284">
  <div class="content">
      <div class="meta-top">
        <a class="avatar" href="http://www.jianshu.com/users/3718163e49e5">
          <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/7862ae8c3843.jpg" alt="100">
</a>        <p>
          <a class="author-name" href="http://www.jianshu.com/users/3718163e49e5">kamidox</a>
        </p>
        <span class="reply-time">
          <small>3 楼 · </small>
          <a href="http://www.jianshu.com/p/0049e9b344b0/comments/318284#comment-318284">2015.05.15 13:49</a></span>
      </div>
      <p><a href="http://www.jianshu.com/users/5f4b588e2526" class="maleskine-author" target="_blank" data-user-slug="5f4b588e2526">@Hugetimor</a> 你的 activity 被 com.android.volley.Response$ErrorListener 引用了。应该是你在 onCreate 或 onResume 之类的函数里注册了错误监听函数，但没有在相应的地方反注册。</p>
      <div class="comment-footer clearfix text-right">
        <a data-id="318284" class="like pull-left" href="javascript:void(0)">
          <i class="fa fa-heart-o"></i>喜欢<span>(0)</span>
</a>        

        <a data-id="318284" data-nickname="kamidox" class="reply" href="javascript:void(0)">回复</a>
        
        
      </div>
    <div class="child-comment-list hide">
      
      <div data-state="remaining-child-comments"></div>
    </div>
  </div>
</div>

<div class="note-comment clearfix" id="comment-318293">
  <div class="content">
      <div class="meta-top">
        <a class="avatar" href="http://www.jianshu.com/users/5f4b588e2526">
          <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/25aeda154962" alt="100">
</a>        <p>
          <a class="author-name" href="http://www.jianshu.com/users/5f4b588e2526">Hugetimor</a>
        </p>
        <span class="reply-time">
          <small>4 楼 · </small>
          <a href="http://www.jianshu.com/p/0049e9b344b0/comments/318293#comment-318293">2015.05.15 13:53</a></span>
      </div>
      <p> <a href="http://www.jianshu.com/users/3718163e49e5" class="maleskine-author" target="_blank" data-user-slug="3718163e49e5">@kamidox</a> 是使用了没用好的Volley导致泄露，我看stackoverflow有人说应该在application全局建立quene，待会下课我去实验下。另外不明白你说的反注册。求解答。</p>
      <div class="comment-footer clearfix text-right">
        <a data-id="318293" class="like pull-left" href="javascript:void(0)">
          <i class="fa fa-heart-o"></i>喜欢<span>(0)</span>
</a>        

        <a data-id="318293" data-nickname="Hugetimor" class="reply" href="javascript:void(0)">回复</a>
        
        
      </div>
    <div class="child-comment-list ">
        <div class="child-comment" id="comment-893515" data-id="893515">
    <p>
      <a class="blue-link" href="http://www.jianshu.com/users/88dc77c46a87">ikzjfr0</a>：
      <a href="http://www.jianshu.com/users/5f4b588e2526" class="maleskine-author" target="_blank" data-user-slug="5f4b588e2526">@Hugetimor</a> 一般都是成对使用，比如onResume中registerXX,在onPause中unregisterXX
    </p>
    <div class="child-comment-footer text-right clearfix">
      
      <a data-id="318293" data-nickname="ikzjfr0" class="reply" href="javascript:void(null)">回复</a>
      
      
      <span class="reply-time pull-left">
        <a href="http://www.jianshu.com/p/0049e9b344b0/comments/893515#comment-893515">2015.11.17 19:12</a></span>
      
    </div>
  </div>

      <div data-state="remaining-child-comments"></div>
        <div class="comment-toolbar clearfix">
          <span class="pull-right">
            <a data-id="318293" class="reply" href="javascript:void(null)"><i class="fa fa-pencil"></i> 添加新回复</a>
          </span>
        </div>
    </div>
  </div>
</div>

<div class="note-comment clearfix" id="comment-893527">
  <div class="content">
      <div class="meta-top">
        <a class="avatar" href="http://www.jianshu.com/users/88dc77c46a87">
          <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/e6b63cd70839" alt="100">
</a>        <p>
          <a class="author-name" href="http://www.jianshu.com/users/88dc77c46a87">ikzjfr0</a>
        </p>
        <span class="reply-time">
          <small>5 楼 · </small>
          <a href="http://www.jianshu.com/p/0049e9b344b0/comments/893527#comment-893527">2015.11.17 19:16</a></span>
      </div>
      <p>好奇问下getRefWatcher的方法中，为啥不是直接用(ExampleApplication)getApplicationContext(),而是使用context去获取： (ExampleApplication) context.getApplicationContext();;</p>
      <div class="comment-footer clearfix text-right">
        <a data-id="893527" class="like pull-left" href="javascript:void(0)">
          <i class="fa fa-heart-o"></i>喜欢<span>(0)</span>
</a>        

        <a data-id="893527" data-nickname="ikzjfr0" class="reply" href="javascript:void(0)">回复</a>
        
        
      </div>
    <div class="child-comment-list hide">
      
      <div data-state="remaining-child-comments"></div>
    </div>
  </div>
</div>

<div class="note-comment clearfix" id="comment-1122366">
  <div class="content">
      <div class="meta-top">
        <a class="avatar" href="http://www.jianshu.com/users/d9f4535db231">
          <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/8-77a9d346e43ea9a5ea58086d74909362.jpg" alt="8">
</a>        <p>
          <a class="author-name" href="http://www.jianshu.com/users/d9f4535db231">KennethYo</a>
        </p>
        <span class="reply-time">
          <small>6 楼 · </small>
          <a href="http://www.jianshu.com/p/0049e9b344b0/comments/1122366#comment-1122366">2015.12.29 14:32</a></span>
      </div>
      <p>《Android 内存与性能》这个文章链接失效了，404.</p>
      <div class="comment-footer clearfix text-right">
        <a data-id="1122366" class="like pull-left" href="javascript:void(0)">
          <i class="fa fa-heart-o"></i>喜欢<span>(0)</span>
</a>        

        <a data-id="1122366" data-nickname="KennethYo" class="reply" href="javascript:void(0)">回复</a>
        
        
      </div>
    <div class="child-comment-list ">
        <div class="child-comment" id="comment-1151678" data-id="1151678">
    <p>
      <a class="blue-link" href="http://www.jianshu.com/users/3718163e49e5">kamidox</a>：
      <a href="http://www.jianshu.com/users/d9f4535db231" class="maleskine-author" target="_blank" data-user-slug="d9f4535db231">@KennethYo</a> 己更新，可以访问了。
    </p>
    <div class="child-comment-footer text-right clearfix">
      
      <a data-id="1122366" data-nickname="kamidox" class="reply" href="javascript:void(null)">回复</a>
      
      
      <span class="reply-time pull-left">
        <a href="http://www.jianshu.com/p/0049e9b344b0/comments/1151678#comment-1151678">2016.01.03 16:48</a></span>
      
    </div>
  </div>

      <div data-state="remaining-child-comments"></div>
        <div class="comment-toolbar clearfix">
          <span class="pull-right">
            <a data-id="1122366" class="reply" href="javascript:void(null)"><i class="fa fa-pencil"></i> 添加新回复</a>
          </span>
        </div>
    </div>
  </div>
</div>


</div>
          <p class="signout-comment">
    <a class="btn btn-info" data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in">
      登录后发表评论
</a>  </p>

    </div>
    <!-- -->

  </div>

  <script type="application/json" data-name="note">
    {"id":1417901,"abbr":"前言你被概率性的OOM困扰么？有时候，OOM像幽灵一样，挥之不去，可真想把它揪出来时，又捉之不着。或许，是时候用LeakCanary来诊断一下了。它是一个用来检查Android下内存泄漏的开源库，这篇文章主要介绍其用法、架构和其背后的实现原理。Square有篇文章介绍了开发这个库的原因。他们的一个付款流程里，需要用到用户的签名，他们直接用Bitmap来画签名，Bitmap大小和屏幕分辨率是一样的。问题来了，在试图创建这个Bitmap对象时，概率性OOM如幽灵般相随。他们试了几个方法：使用Bitmap.Config.ALPHA...","slug":"0049e9b344b0","url":"http://www.jianshu.com/p/0049e9b344b0","image_url":"http://cwb.assets.jianshu.io/notes/images/1417901/weibo/image_c78190044919.jpg","wordage":1769,"has_further_readings":false,"views_count":7724,"likes_count":19,"comments_count":7,"rewards_total_count":0}
  </script>

  <script type="application/json" data-name="uuid">
    {"uuid":"9834f633-9cde-4653-89d2-760f8aad6684"}
  </script>

  <script type="application/json" data-name="author">
    {"id":184896,"nickname":"kamidox","slug":"3718163e49e5","public_notes_count":38,"followers_count":536,"total_likes_count":1292,"is_current_user":false,"is_signed_author":false}
  </script>


    <div class="include-collection">
      <div class="content">
        <h5>被以下专题收入，发现更多相似内容：</h5>
        <ul id="all-collections" class="unstyled collections-list">
            <li>
              <a class="avatar" href="http://www.jianshu.com/collection/NEt52a"><img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/computer_guy.jpg" alt="180"></a>              <div class="collections-info">
                <h5>
                  <a href="http://www.jianshu.com/collection/NEt52a">程序员</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>105.3K</span>
  </div>

                <p class="description">简书程序员大本营

投稿须知：
1.本专题仅收录与程序有关的文章。
2.请在代码框里写代码，尽量保证可看性。

关注简书官...</p>
                <p>
                  <a class="blue-link" href="http://www.jianshu.com/collection/NEt52a">16691篇文章</a> · 105384人关注
                </p>
              </div>
            </li>
            <li>
              <a class="avatar" href="http://www.jianshu.com/collection/0f5e015fc36c"><img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/3.png" alt="180"></a>              <div class="collections-info">
                <h5>
                  <a href="http://www.jianshu.com/collection/0f5e015fc36c">代码改变世界</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>10.7K</span>
  </div>

                <p class="description">Write the Code, Change the World, 改变世界从编程开始, 收集编程相关的干货</p>
                <p>
                  <a class="blue-link" href="http://www.jianshu.com/collection/0f5e015fc36c">1806篇文章</a> · 10714人关注
                </p>
              </div>
            </li>
            <li>
              <a class="avatar" href="http://www.jianshu.com/collection/4da1e44608a3"><img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/1429750643.jpg" alt="180"></a>              <div class="collections-info">
                <h5>
                  <a href="http://www.jianshu.com/collection/4da1e44608a3">Android静水流深</a>
                </h5>
                
  <div class="btn btn-success follow">
    <a data-signin-link="true" data-toggle="modal" href="http://www.jianshu.com/sign_in"><i class="fa fa-fw fa-plus"></i>  <span>添加关注</span></a>
    <span>59</span>
  </div>

                <p class="description">收藏具有开发价值的文章</p>
                <p>
                  <a class="blue-link" href="http://www.jianshu.com/collection/4da1e44608a3">75篇文章</a> · 59人关注
                </p>
              </div>
            </li>
        </ul>
      </div>
    </div>

  <!-- Modal -->
    <div class="modal pay-modal text-center hide fade" id="pay-modal">
  <div class="modal-header clearfix">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <form id="new_reward" class="new_reward" target="_blank" action="http://www.jianshu.com/notes/1417901/rewards" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="Bd1lep/xKaukE3RnzrjcTmtBXyLu24olOjlzK/EH8IokRQGv4ct3Mi7kPBiy311royNXEZrHz+0HhYG/P+vKOQ==">
    <div class="modal-body">
      <a href="http://www.jianshu.com/users/3718163e49e5">
        <div class="avatar"><img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/7862ae8c3843.jpg" alt="100"></div>
</a>      <p><i class="fa fa-quote-left pull-left"></i>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！<i class="fa fa-quote-right pull-right"></i></p>
      <div class="main-inputs text-left">
        <div class="control-group">
          <label for="reward_amount">打赏金额</label><i class="fa fa-yen"></i>
          <input value="2.00" type="text" name="reward[amount_in_yuan]" id="reward_amount_in_yuan">
        </div>
        <div class="control-group message">
          <textarea placeholder="给Ta留言" name="reward[message]" id="reward_message"></textarea>
        </div>
      </div>
      <div class="choose-pay text-left">
        <h5>选择支付方式：</h5>
        <div>
          <label for="reward_channel_alipay">
            <div class="iradio_minimal checked" style="position: relative;"><input type="radio" value="alipay" checked="checked" name="reward[channel]" id="reward_channel_alipay" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
            <span class="alipay-bg"></span>
</label>
          
          <label for="reward_channel_wx_pub_qr">
            <div class="iradio_minimal" style="position: relative;"><input type="radio" value="wx_pub_qr" name="reward[channel]" id="reward_channel_wx_pub_qr" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div>
            微信支付
</label>        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button name="button" type="submit" class="btn btn-large btn-pay">立即支付</button>
    </div>
</form></div>

    <div class="modal success-pay text-center hide fade" id="success-pay">
  <div class="modal-header clearfix">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
  </div>
  <div class="modal-body">
    <h3><i class="icon-ok"></i>打赏成功</h3>
    <img src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/complete-pay-25426877089eb23bd76d9d0e6aad89c1.png" alt="Complete pay">
  </div>
  <div class="modal-footer">
    
  </div>
</div>

</div>

  <div class="imagebubble-backmask image-package" style="z-index: 1000;"><div class="image-caption">leakcanary</div><img class="imagebubble-ghost" src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/leakcanary.png" style="top: 3001.97px; left: 201.591px; width: 620px; height: 277px;"></div></div>
  <div id="flash" class="hide"></div>
  
  <div id="view-mode-modal" tabindex="-1" class="modal hide read-modal" aria-hidden="false" data-js-module="view-mode-modal">
    <div class="btn-group change-background" data-toggle="buttons-radio">
      <a class="btn btn-daytime active" data-mode="day" href="javascript:void(null);">
        <i class="fa fa-sun-o"></i>
</a>      <a class="btn btn-nighttime " data-mode="night" href="javascript:void(null);">
        <i class="fa fa-moon-o"></i>
</a>    </div>
    <div class="btn-group change-font" data-toggle="buttons-radio">
      <a class="btn font " data-font="font1" href="javascript:void(null);">宋体</a>
      <a class="btn font hei active" data-font="font2" href="javascript:void(null);">黑体</a>
    </div>
    <div class="btn-group change-locale" data-toggle="buttons-radio">
      <a class="btn font active" data-locale="zh-CN" href="javascript:void(null);">简</a>
      <a class="btn font hei " data-locale="zh-TW" href="javascript:void(null);">繁</a>
    </div>
  </div>

  

  <script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/base-d3f9a709e5a4537b87b3eff40e94a46e.js"></script>
  
  <script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/reading-base-9132a81390eb5b2cc4f21734b0e9cd08.js"></script>
  <script src="./利用 LeakCanary 来检查 Android 内存泄漏 - 简书_files/note_show-12e94137c3593b4c6278c57fead5ad33.js"></script>
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35169517-1']);
  _gaq.push(['_setCustomVar', 2, 'User Type', 'Visitor', 1 ]);
  _gaq.push(['_trackPageview']);

  

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


<span style="border-radius: 2px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 11px; line-height: 20px; font-family: &quot;Helvetica Neue&quot;, Helvetica, sans-serif; color: rgb(255, 255, 255); position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none; -webkit-font-smoothing: antialiased; background: url(&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzBweCIgd2lkdGg9IjMwcHgiIHZpZXdCb3g9Ii0xIC0xIDMxIDMxIj48Zz48cGF0aCBkPSJNMjkuNDQ5LDE0LjY2MiBDMjkuNDQ5LDIyLjcyMiAyMi44NjgsMjkuMjU2IDE0Ljc1LDI5LjI1NiBDNi42MzIsMjkuMjU2IDAuMDUxLDIyLjcyMiAwLjA1MSwxNC42NjIgQzAuMDUxLDYuNjAxIDYuNjMyLDAuMDY3IDE0Ljc1LDAuMDY3IEMyMi44NjgsMC4wNjcgMjkuNDQ5LDYuNjAxIDI5LjQ0OSwxNC42NjIiIGZpbGw9IiNmZmYiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxIj48L3BhdGg+PHBhdGggZD0iTTE0LjczMywxLjY4NiBDNy41MTYsMS42ODYgMS42NjUsNy40OTUgMS42NjUsMTQuNjYyIEMxLjY2NSwyMC4xNTkgNS4xMDksMjQuODU0IDkuOTcsMjYuNzQ0IEM5Ljg1NiwyNS43MTggOS43NTMsMjQuMTQzIDEwLjAxNiwyMy4wMjIgQzEwLjI1MywyMi4wMSAxMS41NDgsMTYuNTcyIDExLjU0OCwxNi41NzIgQzExLjU0OCwxNi41NzIgMTEuMTU3LDE1Ljc5NSAxMS4xNTcsMTQuNjQ2IEMxMS4xNTcsMTIuODQyIDEyLjIxMSwxMS40OTUgMTMuNTIyLDExLjQ5NSBDMTQuNjM3LDExLjQ5NSAxNS4xNzUsMTIuMzI2IDE1LjE3NSwxMy4zMjMgQzE1LjE3NSwxNC40MzYgMTQuNDYyLDE2LjEgMTQuMDkzLDE3LjY0MyBDMTMuNzg1LDE4LjkzNSAxNC43NDUsMTkuOTg4IDE2LjAyOCwxOS45ODggQzE4LjM1MSwxOS45ODggMjAuMTM2LDE3LjU1NiAyMC4xMzYsMTQuMDQ2IEMyMC4xMzYsMTAuOTM5IDE3Ljg4OCw4Ljc2NyAxNC42NzgsOC43NjcgQzEwLjk1OSw4Ljc2NyA4Ljc3NywxMS41MzYgOC43NzcsMTQuMzk4IEM4Ljc3NywxNS41MTMgOS4yMSwxNi43MDkgOS43NDksMTcuMzU5IEM5Ljg1NiwxNy40ODggOS44NzIsMTcuNiA5Ljg0LDE3LjczMSBDOS43NDEsMTguMTQxIDkuNTIsMTkuMDIzIDkuNDc3LDE5LjIwMyBDOS40MiwxOS40NCA5LjI4OCwxOS40OTEgOS4wNCwxOS4zNzYgQzcuNDA4LDE4LjYyMiA2LjM4NywxNi4yNTIgNi4zODcsMTQuMzQ5IEM2LjM4NywxMC4yNTYgOS4zODMsNi40OTcgMTUuMDIyLDYuNDk3IEMxOS41NTUsNi40OTcgMjMuMDc4LDkuNzA1IDIzLjA3OCwxMy45OTEgQzIzLjA3OCwxOC40NjMgMjAuMjM5LDIyLjA2MiAxNi4yOTcsMjIuMDYyIEMxNC45NzMsMjIuMDYyIDEzLjcyOCwyMS4zNzkgMTMuMzAyLDIwLjU3MiBDMTMuMzAyLDIwLjU3MiAxMi42NDcsMjMuMDUgMTIuNDg4LDIzLjY1NyBDMTIuMTkzLDI0Ljc4NCAxMS4zOTYsMjYuMTk2IDEwLjg2MywyNy4wNTggQzEyLjA4NiwyNy40MzQgMTMuMzg2LDI3LjYzNyAxNC43MzMsMjcuNjM3IEMyMS45NSwyNy42MzcgMjcuODAxLDIxLjgyOCAyNy44MDEsMTQuNjYyIEMyNy44MDEsNy40OTUgMjEuOTUsMS42ODYgMTQuNzMzLDEuNjg2IiBmaWxsPSIjYmQwODFjIj48L3BhdGg+PC9nPjwvc3ZnPg==&quot;) 3px 50% / 14px 14px no-repeat rgb(189, 8, 28);">Save</span></body></html>