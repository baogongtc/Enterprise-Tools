$(function(){!function(){var oReplace={wsCache:new WebStorageCache,replace:function(){var _this=this;$.ajax({type:"get",url:"http://internalapi.csdn.net/knowledge/public/public/api/words?x-acl-token=9DeJLGuYSy/6nSmDQen5amEWUh0K",async:!1,dataType:"jsonp",jsonp:"callback",success:function(resobj){var resData,storage,data;"ok"==resobj.msg&&(resData=resobj.data,storage=window.localStorage,data=eval(resData),_this.wsCache.isSupported()&&_this.wsCache.set("realData",resData,{exp:86400,force:!0}),_this.handle($("#article_content"),data))},error:function(){console.log("Send Ajax error ...")}})},handler:function(){var data,_this=this;_this.wsCache.deleteAllExpires(),data=window.localStorage.getItem("realData"),data?(data=JSON.parse(data).hasOwnProperty("v")?JSON.parse(localStorage.getItem("realData")).v:JSON.parse(localStorage.getItem("realData")),data=eval(data),_this.handle($("#article_content"),data)):_this.replace()},handle:function(a,b){function m(a,b){n(a,b);var c=l.replace(/(<p>|<p\s+([^>]+>))(((?!<\/p)[\s\S])+)<\/p>/gi,function(a,b,c,d){var e=d.replace(/((<[^>]+>)*)([^<]*)/gim,function(a,b,c,d){var e,f,g,h,i,k;if(b||(b=""),d)if(0==b.indexOf("<a")||0===j.length)d=d;else{e=[];for(f in j)g=j[f].reg,-1!==d.search(g)&&"contain"!=f&&(d=d.replace(g,"{[("+f+")]}"),e.push(f));for(h=0;h<e.length;h++)i=e[h],k=j[i],d=d.replace("{[("+i+")]}",'<a href="'+k.url+"\" class='replace_word' title=\""+k.tip+"\" target='_blank' style='color:#df3434; font-weight:bold;'>"+k.word+"</a>"),delete j[i]}else d="";return b+d});return b+e+"</p>"});a.html(c)}function n(a,b){var m,n,o,p,q,r,s,t,u,v,w,k=a.text(),l=!1;for(m=0;m<b.length;m++)if(n=b[m].word,o=/([\u4e00-\u9fa5]+)\w*/gi.test(n)?n:"\\b"+n+"\\b",p=new RegExp(o,"i"),-1!==k.search(p)){if(d.length<=0)d.push(p+"");else for(q=0;q<d.length;q++)l=p!=d[q]?!0:!1;l&&d.push(p+""),d=c.unique(d),r=b[m].url,s=b[m].name,t=b[m].logo,u=b[m].subCount,v=b[m].conCount,w=b[m].word,e.push(r),f.push(s),g.push(t),h.push(u),i.push(v),j.push({word:w,url:r,tip:s,reg:p})}j=c.uniqueObj(j)}function o(){var d,a="",b=document.getElementById("relate");if(f.length<=0)b.style.display="none";else{for(b.style.display="block",f=c.unique(f),e=c.unique(e),f=c.unique(f),g=c.unique(g),h=c.unique(h),i=c.unique(i),d=0;d<f.length;d++)a+='<dl class="relate_list" ><dt><a target="_blank" href="'+e[d]+'"><img src="'+g[d]+'" alt="img"/></a></dt><dd><h4><a target="_blank" href="'+e[d]+'">'+f[d]+"</a></h4><p><label><span>"+h[d]+"</span><em>关注</em><i>|</i><span>"+i[d]+"</span><em>收录</em></label></p></dd></dl>";$(".relate_c").html(a)}}var k,l,c=this,d=[],e=[],f=[],g=[],h=[],i=[],j=[];for(k=0;k<b.length;k++)b[k].flg=!1;l=a.html(),m(a,b),o()},unique:function(a){var e,d,b=[],c={};for(d=0;null!=(e=a[d]);d++)c[e]||(b.push(e),c[e]=!0);return b},uniqueObj:function(a){var d,b=[],c=[];if(a.length)for(b.push(a[0]),c.push(a[0].word),d=1;d<a.length;d++)c.push(a[d].word),c.indexOf(a[d].word)==d&&b.push(a[d]);return b},classStyle:function(){var a=$(".replace_word");a.css({color:"#df3434",fontWeight:"bold!important"})}};try{oReplace.classStyle(),oReplace.handler()}catch(error){return console.log(error.message),void 0}}.call(this)});