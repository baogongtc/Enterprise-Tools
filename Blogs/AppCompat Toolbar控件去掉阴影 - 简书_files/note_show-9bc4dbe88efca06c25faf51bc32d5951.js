!function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype={constructor:e,show:function(){var e,n,r,i=this.element,o=i.closest("ul:not(.dropdown-menu)"),a=i.attr("data-target");a||(a=i.attr("href"),a=a&&a.replace(/.*(?=#[^\s]*$)/,"")),i.parent("li").hasClass("active")||(e=o.find(".active:last a")[0],r=t.Event("show",{relatedTarget:e}),i.trigger(r),r.isDefaultPrevented()||(n=t(a),this.activate(i.parent("li"),o),this.activate(n,n.parent(),function(){i.trigger({type:"shown",relatedTarget:e})})))},activate:function(e,n,r){function i(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),r&&r()}var o=n.find("> .active"),a=r&&t.support.transition&&o.hasClass("fade");a?o.one(t.support.transition.end,i):i(),o.removeClass("in")}};var n=t.fn.tab;t.fn.tab=function(n){return this.each(function(){var r=t(this),i=r.data("tab");i||r.data("tab",i=new e(this)),"string"==typeof n&&i[n]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this},t(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(window.jQuery),function(){Maleskine.ShareScripts={share:function(t,e,n,r,i,o,a){var s,l;return e=e.replace(/'/,"%2527"),l=o?I18n.t("reading.social_sharing.self_share_note_text",{note_title:e}):I18n.t("reading.social_sharing.reader_share_note_text",{note_title:e,user:i}),l+=Maleskine.Settings.mention_official_account(t),null!=n&&(n=n.replace(/'/,"%2527"),l=""+l+" \u300c"+n+"\u300d"),s=Maleskine.ShareScripts.getShareUrl(t,e,n,l,r,a),"javascript:void(function(){var d=document;var r='"+s+"';var x=function(){if(!window.open(r,'"+t+"','toolbar=0,status=0,resizable=1,scrollbars=yes,status=1,width=440,height=430,left='+(screen.width-440)/2+',top='+(screen.height-430)/2))location.href=r};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}}())"},getShareUrl:function(t,e,n,r,i,o){var a;switch(e=encodeURIComponent(e),r=encodeURIComponent(r),i=encodeURIComponent(i+("?utm_campaign=maleskine&utm_content=note&utm_medium=reader_share&utm_source="+t)),t){case"weibo":return a="http://service.weibo.com/share/share.php?appkey="+Maleskine.Settings.weibo.appKey+"&title="+encodeURIComponent(r)+"&url="+encodeURIComponent(i)+"&searchPic=false&style=simple",o.length>0&&(a+="&pic="+encodeURIComponent(o[0])),a;case"twitter":return null!=n?"http://twitter.com/share?url="+i+"&text="+r+"&related=jianshucom":"http://twitter.com/share?url="+encodeURIComponent(i)+"&text="+r+"&related=jianshucom";case"douban":return"http://www.douban.com/recommend/?url="+encodeURIComponent(i)+"&title="+e+"&v=1";case"tweibo":return"http://share.v.t.qq.com/index.php?c=share&a=index&url="+encodeURIComponent(i)+"&title="+r;case"qzone":return"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(i)+"&title="+r;case"facebook":return"http://www.facebook.com/sharer.php?s=100&p[url]="+encodeURIComponent(i)+"&p[title]="+e+"&p[summary]="+r;case"google_plus":return"http://plus.google.com/share?url="+encodeURIComponent(i);case"renren":return"http://widget.renren.com/dialog/share?resourceUrl="+encodeURIComponent(i)+"&description="+r+"&title="+e}}}}.call(this),function(){!function(t){return"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e,n,r,i,o,a,s,l,u,h,c;return h="caret",e=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.setPos=function(){return this.domInputor},e.prototype.getIEPosition=function(){return t.noop()},e.prototype.getPosition=function(){return t.noop()},e.prototype.getOldIEPos=function(){var t,e;return e=s.selection.createRange(),t=s.body.createTextRange(),t.moveToElementText(this.domInputor),t.setEndPoint("EndToEnd",e),t.text.length},e.prototype.getPos=function(){var t,e,n;return(n=this.range())?(t=n.cloneRange(),t.selectNodeContents(this.domInputor),t.setEnd(n.endContainer,n.endOffset),e=t.toString().length,t.detach(),e):s.selection?this.getOldIEPos():void 0},e.prototype.getOldIEOffset=function(){var t,e;return t=s.selection.createRange().duplicate(),t.moveStart("character",-1),e=t.getBoundingClientRect(),{height:e.bottom-e.top,left:e.left,top:e.top}},e.prototype.getOffset=function(){var e,n,r,i;if(u.getSelection&&(r=this.range())){if(r.endOffset-1<0)return null;e=r.cloneRange(),e.setStart(r.endContainer,r.endOffset-1),e.setEnd(r.endContainer,r.endOffset),i=e.getBoundingClientRect(),n={height:i.height,left:i.left+i.width,top:i.top},e.detach()}else s.selection&&(n=this.getOldIEOffset());return n&&!l&&(n.top+=t(u).scrollTop(),n.left+=t(u).scrollLeft()),n},e.prototype.range=function(){var t;if(u.getSelection)return t=u.getSelection(),t.rangeCount>0?t.getRangeAt(0):null},e}(),n=function(){function e(t){this.$inputor=t,this.domInputor=this.$inputor[0]}return e.prototype.getIEPos=function(){var t,e,n,r,i,o,a;return e=this.domInputor,o=s.selection.createRange(),i=0,o&&o.parentElement()===e&&(r=e.value.replace(/\r\n/g,"\n"),n=r.length,a=e.createTextRange(),a.moveToBookmark(o.getBookmark()),t=e.createTextRange(),t.collapse(!1),i=a.compareEndPoints("StartToEnd",t)>-1?n:-a.moveStart("character",-n)),i},e.prototype.getPos=function(){return s.selection?this.getIEPos():this.domInputor.selectionStart},e.prototype.setPos=function(t){var e,n;return e=this.domInputor,s.selection?(n=e.createTextRange(),n.move("character",t),n.select()):e.setSelectionRange&&e.setSelectionRange(t,t),e},e.prototype.getIEOffset=function(t){var e,n,r,i;return n=this.domInputor.createTextRange(),t||(t=this.getPos()),n.move("character",t),r=n.boundingLeft,i=n.boundingTop,e=n.boundingHeight,{left:r,top:i,height:e}},e.prototype.getOffset=function(e){var n,r,i;return n=this.$inputor,s.selection?(r=this.getIEOffset(e),r.top+=t(u).scrollTop()+n.scrollTop(),r.left+=t(u).scrollLeft()+n.scrollLeft(),r):(r=n.offset(),i=this.getPosition(e),r={left:r.left+i.left-n.scrollLeft(),top:r.top+i.top-n.scrollTop(),height:i.height})},e.prototype.getPosition=function(t){var e,n,i,o,a,s;return e=this.$inputor,i=function(t){return t.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/`/g,"&#96").replace(/"/g,"&quot").replace(/\r\n|\r|\n/g,"<br />")},void 0===t&&(t=this.getPos()),s=e.val().slice(0,t),o="<span>"+i(s)+"</span>",o+="<span id='caret'>|</span>",a=new r(e),n=a.create(o).rect()},e.prototype.getIEPosition=function(t){var e,n,r,i,o;return r=this.getIEOffset(t),n=this.$inputor.offset(),i=r.left-n.left,o=r.top-n.top,e=r.height,{left:i,top:o,height:e}},e}(),r=function(){function e(t){this.$inputor=t}return e.prototype.css_attr=["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX","text-align"],e.prototype.mirrorCss=function(){var e,n=this;return e={position:"absolute",left:-9999,top:0,zIndex:-2e4,"white-space":"pre-wrap"},t.each(this.css_attr,function(t,r){return e[r]=n.$inputor.css(r)}),e},e.prototype.create=function(e){return this.$mirror=t("<div></div>"),this.$mirror.css(this.mirrorCss()),this.$mirror.html(e),this.$inputor.after(this.$mirror),this},e.prototype.rect=function(){var t,e,n;return t=this.$mirror.find("#caret"),e=t.position(),n={left:e.left,top:e.top,height:t.height()},this.$mirror.remove(),n},e}(),i={contentEditable:function(t){return!(!t[0].contentEditable||"true"!==t[0].contentEditable)}},a={pos:function(t){return t||0===t?this.setPos(t):this.getPos()},position:function(t){return s.selection?this.getIEPosition(t):this.getPosition(t)},offset:function(e){var n,r;return r=this.getOffset(e),l&&(n=t(l).offset(),r.top+=n.top,r.left+=n.left),r}},s=null,u=null,l=null,c=function(t){return l=t,u=t.contentWindow,s=t.contentDocument||u.document},o=function(e,n){var r,i;if(t.isPlainObject(n)&&(i=n.iframe))return e.data("caret-iframe",i),c(i);if(i=e.data("caret-iframe"))return c(i);s=e[0].ownerDocument,u=s.defaultView||s.parentWindow;try{return l=u.frameElement}catch(o){r=o}},t.fn.caret=function(r){var s;return"object"==typeof r?(o(this,r),this):a[r]?(o(this),s=i.contentEditable(this)?new e(this):new n(this),a[r].apply(s,Array.prototype.slice.call(arguments,1))):t.error("Method "+r+" does not exist on jQuery.caret")},t.fn.caret.EditableCaret=e,t.fn.caret.InputCaret=n,t.fn.caret.Utils=i,t.fn.caret.apis=a})}.call(this),function(){!function(t){return"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){var e,n,r,i,o,a,s,l,u,h=[].slice;r=function(){function e(e){this.current_flag=null,this.controllers={},this.alias_maps={},this.$inputor=t(e),this.iframe=null,this.setIframe(),this.listen()}return e.prototype.setIframe=function(t){var e;if(t)return this.window=t.contentWindow,this.document=t.contentDocument||this.window.document,this.iframe=t,this;this.document=this.$inputor[0].ownerDocument,this.window=this.document.defaultView||this.document.parentWindow;try{return this.iframe=this.window.frameElement}catch(n){e=n}},e.prototype.controller=function(t){return this.controllers[this.alias_maps[t]||t||this.current_flag]},e.prototype.set_context_for=function(t){return this.current_flag=t,this},e.prototype.reg=function(t,e){var n,r;return n=(r=this.controllers)[t]||(r[t]=new o(this,t)),e.alias&&(this.alias_maps[e.alias]=t),n.init(e),this},e.prototype.listen=function(){return this.$inputor.on("keyup.atwhoInner",function(t){return function(e){return t.on_keyup(e)}}(this)).on("keydown.atwhoInner",function(t){return function(e){return t.on_keydown(e)}}(this)).on("scroll.atwhoInner",function(t){return function(){var e;return null!=(e=t.controller())?e.view.hide():void 0}}(this)).on("blur.atwhoInner",function(t){return function(){var e;return(e=t.controller())?e.view.hide(e.get_opt("display_timeout")):void 0}}(this))},e.prototype.shutdown=function(){var t,e,n;n=this.controllers;for(e in n)t=n[e],t.destroy(),delete this.controllers[e];return this.$inputor.off(".atwhoInner")},e.prototype.dispatch=function(){return t.map(this.controllers,function(t){return function(e){var n;return(n=e.get_opt("delay"))?(clearTimeout(t.delayedCallback),t.delayedCallback=setTimeout(function(){return e.look_up()?t.set_context_for(e.at):void 0},n)):e.look_up()?t.set_context_for(e.at):void 0}}(this))},e.prototype.on_keyup=function(e){var n;switch(e.keyCode){case s.ESC:e.preventDefault(),null!=(n=this.controller())&&n.view.hide();break;case s.DOWN:case s.UP:case s.CTRL:t.noop();break;case s.P:case s.N:e.ctrlKey||this.dispatch();break;default:this.dispatch()}},e.prototype.on_keydown=function(e){var n,r;if(n=null!=(r=this.controller())?r.view:void 0,n&&n.visible())switch(e.keyCode){case s.ESC:e.preventDefault(),n.hide();break;case s.UP:e.preventDefault(),n.prev();break;case s.DOWN:e.preventDefault(),n.next();break;case s.P:if(!e.ctrlKey)return;e.preventDefault(),n.prev();break;case s.N:if(!e.ctrlKey)return;e.preventDefault(),n.next();break;case s.TAB:case s.ENTER:if(!n.visible())return;e.preventDefault(),n.choose();break;default:t.noop()}},e}(),o=function(){function n(n,r){this.app=n,this.at=r,this.$inputor=this.app.$inputor,this.id=this.$inputor[0].id||this.uid(),this.setting=null,this.query=null,this.pos=0,this.cur_rect=null,this.range=null,e.append(this.$el=t("<div id='atwho-ground-"+this.id+"'></div>")),this.model=new l(this),this.view=new u(this)}return n.prototype.uid=function(){return(Math.random().toString(16)+"000000000").substr(2,8)+(new Date).getTime()},n.prototype.init=function(e){return this.setting=t.extend({},this.setting||t.fn.atwho["default"],e),this.view.init(),this.model.reload(this.setting.data)},n.prototype.destroy=function(){return this.trigger("beforeDestroy"),this.model.destroy(),this.view.destroy(),this.$el.remove()},n.prototype.call_default=function(){var e,n,r;r=arguments[0],e=2<=arguments.length?h.call(arguments,1):[];try{return a[r].apply(this,e)}catch(i){return n=i,t.error(""+n+" Or maybe At.js doesn't have function "+r)}},n.prototype.trigger=function(t,e){var n,r;return null==e&&(e=[]),e.push(this),n=this.get_opt("alias"),r=n?""+t+"-"+n+".atwho":""+t+".atwho",this.$inputor.trigger(r,e)},n.prototype.callbacks=function(t){return this.get_opt("callbacks")[t]||a[t]},n.prototype.get_opt=function(t){var e;try{return this.setting[t]}catch(n){return e=n,null}},n.prototype.content=function(){return this.$inputor.is("textarea, input")?this.$inputor.val():this.$inputor.text()},n.prototype.catch_query=function(){var t,e,n,r,i,o;return e=this.content(),t=this.$inputor.caret("pos"),o=e.slice(0,t),r=this.callbacks("matcher").call(this,this.at,o,this.get_opt("start_with_space")),"string"==typeof r&&r.length<=this.get_opt("max_len",20)?(i=t-r.length,n=i+r.length,this.pos=i,r={text:r,head_pos:i,end_pos:n},this.trigger("matched",[this.at,r.text])):(r=null,this.view.hide()),this.query=r},n.prototype.rect=function(){var t,e;if(t=this.$inputor.caret({iframe:this.app.iframe}).caret("offset",this.pos-1))return"true"===this.$inputor.attr("contentEditable")&&(t=this.cur_rect||(this.cur_rect=t)||t),e=this.app.document.selection?0:2,{left:t.left,top:t.top,bottom:t.top+t.height+e}},n.prototype.reset_rect=function(){return"true"===this.$inputor.attr("contentEditable")?this.cur_rect=null:void 0},n.prototype.mark_range=function(){return"true"===this.$inputor.attr("contentEditable")&&(this.app.window.getSelection&&(this.range=this.app.window.getSelection().getRangeAt(0)),this.app.document.selection)?this.ie8_range=this.app.document.selection.createRange():void 0},n.prototype.insert_content_for=function(e){var n,r,i;return r=e.data("value"),i=this.get_opt("insert_tpl"),this.$inputor.is("textarea, input")||!i?r:(n=t.extend({},e.data("item-data"),{"atwho-data-value":r,"atwho-at":this.at}),this.callbacks("tpl_eval").call(this,i,n))},n.prototype.insert=function(e,n){var r,i,o,a,s,l,u,h,c,d,p;return r=this.$inputor,"true"===r.attr("contentEditable")&&(o="atwho-view-flag atwho-view-flag-"+(this.get_opt("alias")||this.at),a=""+e+"<span contenteditable='false'>&nbsp;<span>",s="<span contenteditable='false' class='"+o+"'>"+a+"</span>",i=t(s,this.app.document).data("atwho-data-item",n.data("item-data")),this.app.document.selection&&(i=t("<span contenteditable='true'></span>",this.app.document).html(i))),r.is("textarea, input")?(e=""+e,c=r.val(),d=c.slice(0,Math.max(this.query.head_pos-this.at.length,0)),p=""+d+e+" "+c.slice(this.query.end_pos||0),r.val(p),r.caret("pos",d.length+e.length+1)):(u=this.range)?(l=u.startOffset-(this.query.end_pos-this.query.head_pos)-this.at.length,u.setStart(u.endContainer,Math.max(l,0)),u.setEnd(u.endContainer,u.endOffset),u.deleteContents(),u.insertNode(i[0]),u.collapse(!1),h=this.app.window.getSelection(),h.removeAllRanges(),h.addRange(u)):(u=this.ie8_range)&&(u.moveStart("character",this.query.end_pos-this.query.head_pos-this.at.length),u.pasteHTML(a),u.collapse(!1),u.select()),r.is(":focus")||r.focus(),r.change()},n.prototype.render_view=function(t){var e;return e=this.get_opt("search_key"),t=this.callbacks("sorter").call(this,this.query.text,t.slice(0,1001),e),this.view.render(t.slice(0,this.get_opt("limit")))},n.prototype.look_up=function(){var e,n;if(e=this.catch_query())return n=function(t){return t&&t.length>0?this.render_view(t):this.view.hide()},this.model.query(e.text,t.proxy(n,this)),e},n}(),l=function(){function e(t){this.context=t,this.at=this.context.at,this.storage=this.context.$inputor}return e.prototype.destroy=function(){return this.storage.data(this.at,null)},e.prototype.saved=function(){return this.fetch()>0},e.prototype.query=function(t,e){var n,r,i;return n=this.fetch(),r=this.context.get_opt("search_key"),n=this.context.callbacks("filter").call(this.context,t,n,r)||[],i=this.context.callbacks("remote_filter"),n.length>0||!i&&0===n.length?e(n):i.call(this.context,t,e)},e.prototype.fetch=function(){return this.storage.data(this.at)||[]},e.prototype.save=function(t){return this.storage.data(this.at,this.context.callbacks("before_save").call(this.context,t||[]))},e.prototype.load=function(t){return!this.saved()&&t?this._load(t):void 0},e.prototype.reload=function(t){return this._load(t)},e.prototype._load=function(e){return"string"==typeof e?t.ajax(e,{dataType:"json"}).done(function(t){return function(e){return t.save(e)}}(this)):this.save(e)},e}(),u=function(){function e(e){this.context=e,this.$el=t("<div class='atwho-view'><ul class='atwho-view-ul'></ul></div>"),this.timeout_id=null,this.context.$el.append(this.$el),this.bind_event()}return e.prototype.init=function(){var t;return t=this.context.get_opt("alias")||this.context.at.charCodeAt(0),this.$el.attr({id:"at-view-"+t})},e.prototype.destroy=function(){return this.$el.remove()},e.prototype.bind_event=function(){var e;return e=this.$el.find("ul"),e.on("mouseenter.atwho-view","li",function(n){return e.find(".cur").removeClass("cur"),t(n.currentTarget).addClass("cur")}).on("click",function(t){return function(e){return t.choose(),e.preventDefault()}}(this))},e.prototype.visible=function(){return this.$el.is(":visible")},e.prototype.choose=function(){var t,e;return(t=this.$el.find(".cur")).length?(e=this.context.insert_content_for(t),this.context.insert(this.context.callbacks("before_insert").call(this.context,e,t),t),this.context.trigger("inserted",[t]),this.hide()):void 0},e.prototype.reposition=function(e){var n,r;return e.bottom+this.$el.height()-t(window).scrollTop()>t(window).height()&&(e.bottom=e.top-this.$el.height()),n={left:e.left,top:e.bottom},null!=(r=this.context.callbacks("before_reposition"))&&r.call(this.context,n),this.$el.offset(n),this.context.trigger("reposition",[n])},e.prototype.next=function(){var t,e;return t=this.$el.find(".cur").removeClass("cur"),e=t.next(),e.length||(e=this.$el.find("li:first")),e.addClass("cur")},e.prototype.prev=function(){var t,e;return t=this.$el.find(".cur").removeClass("cur"),e=t.prev(),e.length||(e=this.$el.find("li:last")),e.addClass("cur")},e.prototype.show=function(){var t;return this.context.mark_range(),this.visible()||(this.$el.show(),this.context.trigger("shown")),(t=this.context.rect())?this.reposition(t):void 0},e.prototype.hide=function(t){var e;return isNaN(t&&this.visible())?(this.context.reset_rect(),this.$el.hide(),this.context.trigger("hidden")):(e=function(t){return function(){return t.hide()}}(this),clearTimeout(this.timeout_id),this.timeout_id=setTimeout(e,t))},e.prototype.render=function(e){var n,r,i,o,a,s,l;if(!(t.isArray(e)&&e.length>0))return void this.hide();for(this.$el.find("ul").empty(),r=this.$el.find("ul"),a=this.context.get_opt("tpl"),s=0,l=e.length;l>s;s++)i=e[s],i=t.extend({},i,{"atwho-at":this.context.at}),o=this.context.callbacks("tpl_eval").call(this.context,a,i),n=t(this.context.callbacks("highlighter").call(this.context,o,this.context.query.text)),n.data("item-data",i),r.append(n);return this.show(),this.context.get_opt("highlight_first")?r.find("li:first").addClass("cur"):void 0},e}(),s={DOWN:40,UP:38,ESC:27,TAB:9,ENTER:13,CTRL:17,P:80,N:78},a={before_save:function(e){var n,r,i,o;if(!t.isArray(e))return e;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(t.isPlainObject(n)?n:{name:n});return o},matcher:function(t,e,n){var r,i;return t=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n&&(t="(?:^|\\s)"+t),i=new RegExp(t+"([A-Za-z0-9_+-]*)$|"+t+"([^\\x00-\\xff]*)$","gi"),r=i.exec(e),r?r[2]||r[1]:null},filter:function(t,e,n){var r,i,o,a;for(a=[],i=0,o=e.length;o>i;i++)r=e[i],~r[n].toLowerCase().indexOf(t.toLowerCase())&&a.push(r);return a},remote_filter:null,sorter:function(t,e,n){var r,i,o,a;if(!t)return e;for(a=[],i=0,o=e.length;o>i;i++)r=e[i],r.atwho_order=r[n].toLowerCase().indexOf(t.toLowerCase()),r.atwho_order>-1&&a.push(r);return a.sort(function(t,e){return t.atwho_order-e.atwho_order})},tpl_eval:function(t,e){var n;try{return t.replace(/\$\{([^\}]*)\}/g,function(t,n){return e[n]})}catch(r){return n=r,""}},highlighter:function(t,e){var n;return e?(n=new RegExp(">\\s*(\\w*)("+e.replace("+","\\+")+")(\\w*)\\s*<","ig"),t.replace(n,function(t,e,n,r){return"> "+e+"<strong>"+n+"</strong>"+r+" <"})):t},before_insert:function(t){return t}},n={load:function(t,e){var n;return(n=this.controller(t))?n.model.load(e):void 0},getInsertedItemsWithIDs:function(e){var n,r,i;return(n=this.controller(e))?(e&&(e="-"+(n.get_opt("alias")||n.at)),r=[],i=t.map(this.$inputor.find("span.atwho-view-flag"+(e||"")),function(e){var n;return n=t(e).data("atwho-data-item"),r.indexOf(n.id)>-1?void 0:(n.id&&(r.push=n.id),n)}),[r,i]):[null,null]},getInsertedItems:function(t){return n.getInsertedItemsWithIDs.apply(this,[t])[1]},getInsertedIDs:function(t){return n.getInsertedItemsWithIDs.apply(this,[t])[0]},setIframe:function(t){return this.setIframe(t)},run:function(){return this.dispatch()},destroy:function(){return this.shutdown(),this.$inputor.data("atwho",null)}},i={init:function(e){var n,i;return i=(n=t(this)).data("atwho"),i||n.data("atwho",i=new r(this)),i.reg(e.at,e),this}},e=t("<div id='atwho-container'></div>"),t.fn.atwho=function(r){var o,a;return a=arguments,t("body").append(e),o=null,this.filter("textarea, input, [contenteditable=true]").each(function(){var e;return"object"!=typeof r&&r?n[r]?(e=t(this).data("atwho"))?o=n[r].apply(e,Array.prototype.slice.call(a,1)):void 0:t.error("Method "+r+" does not exist on jQuery.caret"):i.init.apply(this,a)}),o||this},t.fn.atwho["default"]={at:void 0,alias:void 0,data:null,tpl:"<li data-value='${atwho-at}${name}'>${name}</li>",insert_tpl:"<span>${atwho-data-value}</span>",callbacks:a,search_key:"name",start_with_space:!0,highlight_first:!0,limit:5,max_len:20,display_timeout:300,delay:null}})}.call(this),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(){var e=n(this),a=o.settings;return isNaN(e.datetime)||(0==a.cutoff||Math.abs(i(e.datetime))<a.cutoff)&&t(this).text(r(e.datetime)),this}function n(e){if(e=t(e),!e.data("timeago")){e.data("timeago",{datetime:o.datetime(e)});var n=t.trim(e.text());o.settings.localeTitle?e.attr("title",e.data("timeago").datetime.toLocaleString()):!(n.length>0)||o.isTime(e)&&e.attr("title")||e.attr("title",n)}return e.data("timeago")}function r(t){return o.inWords(i(t))}function i(t){return(new Date).getTime()-t.getTime()}t.timeago=function(e){return r(e instanceof Date?e:"string"==typeof e?t.timeago.parse(e):"number"==typeof e?new Date(e):t.timeago.datetime(e))};var o=t.timeago;t.extend(t.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(e){function n(n,i){var o=t.isFunction(n)?n(i,e):n,a=r.numbers&&r.numbers[i]||i;return o.replace(/%d/i,a)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var r=this.settings.strings,i=r.prefixAgo,o=r.suffixAgo;if(this.settings.allowFuture&&0>e&&(i=r.prefixFromNow,o=r.suffixFromNow),!this.settings.allowPast&&e>=0)return this.settings.strings.inPast;var a=Math.abs(e)/1e3,s=a/60,l=s/60,u=l/24,h=u/365,c=45>a&&n(r.seconds,Math.round(a))||90>a&&n(r.minute,1)||45>s&&n(r.minutes,Math.round(s))||90>s&&n(r.hour,1)||24>l&&n(r.hours,Math.round(l))||42>l&&n(r.day,1)||30>u&&n(r.days,Math.round(u))||45>u&&n(r.month,1)||365>u&&n(r.months,Math.round(u/30))||1.5>h&&n(r.year,1)||n(r.years,Math.round(h)),d=r.wordSeparator||"";return void 0===r.wordSeparator&&(d=" "),t.trim([i,c,o].join(d))},parse:function(e){var n=t.trim(e);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(e){var n=t(e).attr(o.isTime(e)?"datetime":"title");return o.parse(n)},isTime:function(e){return"time"===t(e).get(0).tagName.toLowerCase()}});var a={init:function(){var n=t.proxy(e,this);n();var r=o.settings;r.refreshMillis>0&&(this._timeagoInterval=setInterval(n,r.refreshMillis))},update:function(n){var r=o.parse(n);t(this).data("timeago",{datetime:r}),o.settings.localeTitle&&t(this).attr("title",r.toLocaleString()),e.apply(this)},updateFromDOM:function(){t(this).data("timeago",{datetime:o.parse(t(this).attr(o.isTime(this)?"datetime":"title"))}),e.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};t.fn.timeago=function(t,e){var n=t?a[t]:a.init;if(!n)throw new Error("Unknown function name '"+t+"' for timeago");return this.each(function(){n.call(this,e)}),this},document.createElement("abbr"),document.createElement("time")});var QRCode;!function(){function t(t){this.mode=u.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=[],n=0,r=this.data.length;r>n;n++){var i=this.data.charCodeAt(n);i>65536?(e[0]=240|(1835008&i)>>>18,e[1]=128|(258048&i)>>>12,e[2]=128|(4032&i)>>>6,e[3]=128|63&i):i>2048?(e[0]=224|(61440&i)>>>12,e[1]=128|(4032&i)>>>6,e[2]=128|63&i):i>128?(e[0]=192|(1984&i)>>>6,e[1]=128|63&i):e[0]=i,this.parsedData=this.parsedData.concat(e)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var r=0;r<t.length-n;r++)this.num[r]=t[r+n]}function r(t,e){this.totalCount=t,this.dataCount=e}function i(){this.buffer=[],this.length=0}function o(){return"undefined"!=typeof CanvasRenderingContext2D}function a(){var t=!1,e=navigator.userAgent;return/android/i.test(e)&&(t=!0,aMat=e.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(t=parseFloat(aMat[1]))),t}function s(t,e){for(var n=1,r=l(t),i=0,o=m.length;o>=i;i++){var a=0;switch(e){case h.L:a=m[i][0];break;case h.M:a=m[i][1];break;case h.Q:a=m[i][2];break;case h.H:a=m[i][3]}if(a>=r)break;n++}if(n>m.length)throw new Error("Too long data");return n}function l(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,n=this.parsedData.length;n>e;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var n=new t(e);this.dataList.push(n),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(t,e){for(var n=-1;7>=n;n++)if(!(-1>=t+n||this.moduleCount<=t+n))for(var r=-1;7>=r;r++)-1>=e+r||this.moduleCount<=e+r||(this.modules[t+n][e+r]=n>=0&&6>=n&&(0==r||6==r)||r>=0&&6>=r&&(0==n||6==n)||n>=2&&4>=n&&r>=2&&4>=r?!0:!1)},getBestMaskPattern:function(){for(var t=0,e=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=d.getLostPoint(this);(0==n||t>r)&&(t=r,e=n)}return e},createMovieClip:function(t,e,n){var r=t.createEmptyMovieClip(e,n),i=1;this.make();for(var o=0;o<this.modules.length;o++)for(var a=o*i,s=0;s<this.modules[o].length;s++){var l=s*i,u=this.modules[o][s];u&&(r.beginFill(0,100),r.moveTo(l,a),r.lineTo(l+i,a),r.lineTo(l+i,a+i),r.lineTo(l,a+i),r.endFill())}return r},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=0==t%2);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=0==e%2)},setupPositionAdjustPattern:function(){for(var t=d.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var n=0;n<t.length;n++){var r=t[e],i=t[n];if(null==this.modules[r][i])for(var o=-2;2>=o;o++)for(var a=-2;2>=a;a++)this.modules[r+o][i+a]=-2==o||2==o||-2==a||2==a||0==o&&0==a?!0:!1}},setupTypeNumber:function(t){for(var e=d.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!t&&1==(1&e>>n);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(var n=0;18>n;n++){var r=!t&&1==(1&e>>n);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(t,e){for(var n=this.errorCorrectLevel<<3|e,r=d.getBCHTypeInfo(n),i=0;15>i;i++){var o=!t&&1==(1&r>>i);6>i?this.modules[i][8]=o:8>i?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(var i=0;15>i;i++){var o=!t&&1==(1&r>>i);8>i?this.modules[8][this.moduleCount-i-1]=o:9>i?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var n=-1,r=this.moduleCount-1,i=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[r][a-s]){var l=!1;o<t.length&&(l=1==(1&t[o]>>>i));var u=d.getMask(e,r,a-s);u&&(l=!l),this.modules[r][a-s]=l,i--,-1==i&&(o++,i=7)}if(r+=n,0>r||this.moduleCount<=r){r-=n,n=-n;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,n,o){for(var a=r.getRSBlocks(t,n),s=new i,l=0;l<o.length;l++){var u=o[l];s.put(u.mode,4),s.put(u.getLength(),d.getLengthInBits(u.mode,t)),u.write(s)}for(var h=0,l=0;l<a.length;l++)h+=a[l].dataCount;if(s.getLengthInBits()>8*h)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*h+")");for(s.getLengthInBits()+4<=8*h&&s.put(0,4);0!=s.getLengthInBits()%8;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*h)&&(s.put(e.PAD0,8),!(s.getLengthInBits()>=8*h));)s.put(e.PAD1,8);return e.createBytes(s,a)},e.createBytes=function(t,e){for(var r=0,i=0,o=0,a=new Array(e.length),s=new Array(e.length),l=0;l<e.length;l++){var u=e[l].dataCount,h=e[l].totalCount-u;i=Math.max(i,u),o=Math.max(o,h),a[l]=new Array(u);for(var c=0;c<a[l].length;c++)a[l][c]=255&t.buffer[c+r];r+=u;var p=d.getErrorCorrectPolynomial(h),f=new n(a[l],p.getLength()-1),m=f.mod(p);s[l]=new Array(p.getLength()-1);for(var c=0;c<s[l].length;c++){var g=c+m.getLength()-s[l].length;s[l][c]=g>=0?m.get(g):0}}for(var _=0,c=0;c<e.length;c++)_+=e[c].totalCount;for(var w=new Array(_),v=0,c=0;i>c;c++)for(var l=0;l<e.length;l++)c<a[l].length&&(w[v++]=a[l][c]);for(var c=0;o>c;c++)for(var l=0;l<e.length;l++)c<s[l].length&&(w[v++]=s[l][c]);return w};for(var u={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},h={L:1,M:0,Q:3,H:2},c={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},d={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;d.getBCHDigit(e)-d.getBCHDigit(d.G15)>=0;)e^=d.G15<<d.getBCHDigit(e)-d.getBCHDigit(d.G15);return(t<<10|e)^d.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;d.getBCHDigit(e)-d.getBCHDigit(d.G18)>=0;)e^=d.G18<<d.getBCHDigit(e)-d.getBCHDigit(d.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return d.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,n){switch(t){case c.PATTERN000:return 0==(e+n)%2;case c.PATTERN001:return 0==e%2;case c.PATTERN010:return 0==n%3;case c.PATTERN011:return 0==(e+n)%3;case c.PATTERN100:return 0==(Math.floor(e/2)+Math.floor(n/3))%2;
case c.PATTERN101:return 0==e*n%2+e*n%3;case c.PATTERN110:return 0==(e*n%2+e*n%3)%2;case c.PATTERN111:return 0==(e*n%3+(e+n)%2)%2;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new n([1],0),r=0;t>r;r++)e=e.multiply(new n([1,p.gexp(r)],0));return e},getLengthInBits:function(t,e){if(e>=1&&10>e)switch(t){case u.MODE_NUMBER:return 10;case u.MODE_ALPHA_NUM:return 9;case u.MODE_8BIT_BYTE:return 8;case u.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case u.MODE_NUMBER:return 12;case u.MODE_ALPHA_NUM:return 11;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case u.MODE_NUMBER:return 14;case u.MODE_ALPHA_NUM:return 13;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),n=0,r=0;e>r;r++)for(var i=0;e>i;i++){for(var o=0,a=t.isDark(r,i),s=-1;1>=s;s++)if(!(0>r+s||r+s>=e))for(var l=-1;1>=l;l++)0>i+l||i+l>=e||(0!=s||0!=l)&&a==t.isDark(r+s,i+l)&&o++;o>5&&(n+=3+o-5)}for(var r=0;e-1>r;r++)for(var i=0;e-1>i;i++){var u=0;t.isDark(r,i)&&u++,t.isDark(r+1,i)&&u++,t.isDark(r,i+1)&&u++,t.isDark(r+1,i+1)&&u++,(0==u||4==u)&&(n+=3)}for(var r=0;e>r;r++)for(var i=0;e-6>i;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(n+=40);for(var i=0;e>i;i++)for(var r=0;e-6>r;r++)t.isDark(r,i)&&!t.isDark(r+1,i)&&t.isDark(r+2,i)&&t.isDark(r+3,i)&&t.isDark(r+4,i)&&!t.isDark(r+5,i)&&t.isDark(r+6,i)&&(n+=40);for(var h=0,i=0;e>i;i++)for(var r=0;e>r;r++)t.isDark(r,i)&&h++;var c=Math.abs(100*h/e/e-50)/5;return n+=10*c}},p={glog:function(t){if(1>t)throw new Error("glog("+t+")");return p.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return p.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},f=0;8>f;f++)p.EXP_TABLE[f]=1<<f;for(var f=8;256>f;f++)p.EXP_TABLE[f]=p.EXP_TABLE[f-4]^p.EXP_TABLE[f-5]^p.EXP_TABLE[f-6]^p.EXP_TABLE[f-8];for(var f=0;255>f;f++)p.LOG_TABLE[p.EXP_TABLE[f]]=f;n.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),r=0;r<this.getLength();r++)for(var i=0;i<t.getLength();i++)e[r+i]^=p.gexp(p.glog(this.get(r))+p.glog(t.get(i)));return new n(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=p.glog(this.get(0))-p.glog(t.get(0)),r=new Array(this.getLength()),i=0;i<this.getLength();i++)r[i]=this.get(i);for(var i=0;i<t.getLength();i++)r[i]^=p.gexp(p.glog(t.get(i))+e);return new n(r,0).mod(t)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(t,e){var n=r.getRsBlockTable(t,e);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var i=n.length/3,o=[],a=0;i>a;a++)for(var s=n[3*a+0],l=n[3*a+1],u=n[3*a+2],h=0;s>h;h++)o.push(new r(l,u));return o},r.getRsBlockTable=function(t,e){switch(e){case h.L:return r.RS_BLOCK_TABLE[4*(t-1)+0];case h.M:return r.RS_BLOCK_TABLE[4*(t-1)+1];case h.Q:return r.RS_BLOCK_TABLE[4*(t-1)+2];case h.H:return r.RS_BLOCK_TABLE[4*(t-1)+3];default:return void 0}},i.prototype={get:function(t){var e=Math.floor(t/8);return 1==(1&this.buffer[e]>>>7-t%8)},put:function(t,e){for(var n=0;e>n;n++)this.putBit(1==(1&t>>>e-n-1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var r in e)e.hasOwnProperty(r)&&n.setAttribute(r,e[r]);return n}var n=this._htOption,r=this._el,i=t.getModuleCount();Math.floor(n.width/i),Math.floor(n.height/i),this.clear();var o=e("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:n.colorLight});o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(o),o.appendChild(e("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;i>a;a++)for(var s=0;i>s;s++)if(t.isDark(a,s)){var l=e("use",{x:String(a),y:String(s)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),o.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),_="svg"===document.documentElement.tagName.toLowerCase(),w=_?g:o()?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function e(t,e){var n=this;if(n._fFail=e,n._fSuccess=t,null===n._bSupportDataURI){var r=document.createElement("img"),i=function(){n._bSupportDataURI=!1,n._fFail&&_fFail.call(n)},o=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)};return r.onabort=i,r.onerror=i,r.onload=o,void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}n._bSupportDataURI===!0&&n._fSuccess?n._fSuccess.call(n):n._bSupportDataURI===!1&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,e,i,o,a,s,l,u){if("nodeName"in t&&/img/i.test(t.nodeName))for(var h=arguments.length-1;h>=1;h--)arguments[h]=arguments[h]*n;else"undefined"==typeof u&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);r.apply(this,arguments)}}var i=function(t,e){this._bIsPainted=!1,this._android=a(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(t){var e=this._elImage,n=this._oContext,r=this._htOption,i=t.getModuleCount(),o=r.width/i,a=r.height/i,s=Math.round(o),l=Math.round(a);e.style.display="none",this.clear();for(var u=0;i>u;u++)for(var h=0;i>h;h++){var c=t.isDark(u,h),d=h*o,p=u*a;n.strokeStyle=c?r.colorDark:r.colorLight,n.lineWidth=1,n.fillStyle=c?r.colorDark:r.colorLight,n.fillRect(d,p,o,a),n.strokeRect(Math.floor(d)+.5,Math.floor(p)+.5,s,l),n.strokeRect(Math.ceil(d)-.5,Math.ceil(p)-.5,s,l)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&e.call(this,t)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},i}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,n=this._el,r=t.getModuleCount(),i=Math.floor(e.width/r),o=Math.floor(e.height/r),a=['<table style="border:0;border-collapse:collapse;">'],s=0;r>s;s++){a.push("<tr>");for(var l=0;r>l;l++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+o+"px;background-color:"+(t.isDark(s,l)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),n.innerHTML=a.join("");var u=n.childNodes[0],h=(e.width-u.offsetWidth)/2,c=(e.height-u.offsetHeight)/2;h>0&&c>0&&(u.style.margin=c+"px "+h+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:h.H},"string"==typeof e&&(e={text:e}),e)for(var n in e)this._htOption[n]=e[n];"string"==typeof t&&(t=document.getElementById(t)),this._android=a(),this._el=t,this._oQRCode=null,this._oDrawing=new w(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(t){this._oQRCode=new e(s(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=h}(),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.NoteLike=function(e){function r(e){this.initLikesModal=t(this.initLikesModal,this),this.closeLikesModal=t(this.closeLikesModal,this),this.initItemTooltip=t(this.initItemTooltip,this),this.loadMoreLikeItems=t(this.loadMoreLikeItems,this),this.loadLikeItems=t(this.loadLikeItems,this),this.initLikeButton=t(this.initLikeButton,this),r.__super__.constructor.apply(this,arguments),this.note=e.note,this.note||(this.note=JSON.parse($("script[data-name=note]").html())),$.timeago.settings.strings=I18n.t("jquery-timeago"),this.initLikeButton(),this.initLikesModal(),this.loadLikeItems(),this.likesCount.on("click",function(){return $("#likes-modal").modal("show")})}return n(r,e),r.prototype.elements={"#likes-modal":"likesModal","#likes-modal div.modal-body":"modalBody","#likes-modal ul":"likeList","#likes-modal a.more":"loadMore","#likes-count":"likesCount"},r.prototype.events={"click #likes-modal":"closeLikesModal"},r.prototype.initLikeButton=function(){var t;return this.likesCount.html(this.note.likes_count.toString()),t=this.$("div.like"),t.on("click",function(t){return $(this).parents().find("div.like").hasClass("load")?(t.preventDefault(),t.stopPropagation()):void 0}),t.on("ajax:beforeSend",function(){return $(this).parents().find("div.like").addClass("load")}),t.on("ajax:complete",function(){return $(this).parents().find("div.like").removeClass("load")})},r.prototype.loadLikeItems=function(){return this.likeList.load(Routes.likes_note_path(this.note.id,{format:"html"}))},r.prototype.loadMoreLikeItems=function(){var t;return t=this.likesModal.find("a.more").data("max-id"),this.likesModal.find("a.more").length>0&&null!=t?(this.likesModal.find("a.more").data("max-id",null),$.get(Routes.likes_note_path(this.note.id,{max_id:t,format:"html"}),function(t){return function(e){return t.likesModal.find("a.more").replaceWith(e)}}(this))):void 0},r.prototype.initItemTooltip=function(){return this.likeList.find("a.avatar").tooltip({placement:"bottom",title:function(){return I18n.t("reading.notes.show.like_item_tooltip",{nickname:$(this).data("nickname"),timeago:$.timeago(new Date($(this).data("created-at")))})}})},r.prototype.closeLikesModal=function(t){return $(t.target).find(".modal-dialog").length>0?$(t.currentTarget).modal("hide"):void 0},r.prototype.initLikesModal=function(){return this.likesModal.scroll(function(t){return function(){return t.likesModal.height()+t.likesModal.scrollTop()+200>=t.likesModal.find(".modal-content").height()?t.loadMoreLikeItems():void 0}}(this)),this.likesModal.on("show",function(t){return function(){return $("body").addClass("modal-open"),t.likesModal.scroll()}}(this)),this.likesModal.on("hide",function(){return $("body").removeClass("modal-open")})},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.RewardInfo=function(e){function r(e){this.initRewardsTotalCount=t(this.initRewardsTotalCount,this),this.initRewardModal=t(this.initRewardModal,this),this.initRewardTooltip=t(this.initRewardTooltip,this),this.loadMoreRewardItems=t(this.loadMoreRewardItems,this),this.loadRewardItems=t(this.loadRewardItems,this),r.__super__.constructor.apply(this,arguments),this.loadRewardItems(),this.totalCount.length>0&&this.initRewardsTotalCount(),this.note=e.note,this.currentUser=e.current_user,this.reward=e.reward,this.reward||0===$("script[data-name=reward]").length||(this.reward=JSON.parse($("script[data-name=reward]").html()).rewards),$("#rewards-modal").on("click",function(t){return $(t.target).find(".modal-dialog").length>0?$("#rewards-modal").modal("hide"):void 0}),$("#rewards-modal").on("show",function(t){return function(){return $("body").addClass("modal-open"),t.initRewardModal()}}(this)),$("#rewards-modal").on("hide",function(){return $("body").removeClass("modal-open")})}return n(r,e),r.prototype.elements={".avatar-list":"avatarList","a.rewards-total-count":"totalCount"},r.prototype.events={"click .avatar-list > a.more":"loadMoreRewardItems"},r.prototype.loadRewardItems=function(){return this.avatarList.load(Routes.rewards_note_path(this.note.id,{format:"html"}),function(t){return function(){return t.initRewardTooltip()}}(this))},r.prototype.loadMoreRewardItems=function(t){var e;return e=$(t.currentTarget).data("max-id"),$.get(Routes.rewards_note_path(this.note.id,{max_id:e,format:"html"}),function(e){return function(n){return $(t.currentTarget).replaceWith(n),e.initRewardTooltip()}}(this))},r.prototype.initRewardTooltip=function(){return this.avatarList.find("a.avatar[data-nickname]").tooltip({title:function(){return I18n.t("reading.notes.show.reward.tooltip",{nickname:$(this).data("nickname"),timeago:$.timeago(new Date($(this).data("created-at")))})}})},r.prototype.initRewardModal=function(){return $("#rewards-modal").find("ul").html(JST.render("note/reward_item_in_modal",{rewards:this.reward}))},r.prototype.initRewardsTotalCount=function(){return this.totalCount.html(this.note.rewards_total_count)},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.CommentForm=function(e){function r(e){this.insertEmoji=t(this.insertEmoji,this),this.initEmojiSet=t(this.initEmojiSet,this),this.initAtUsers=t(this.initAtUsers,this);var n,i;r.__super__.constructor.apply(this,arguments),this.initAtUsers(),this.initEmojiSet(),this.emojiInitialized=e.emojiInitialized,this.el.on("click","[data-toggle=modal]",function(){return function(t){return $(t.currentTarget).parent().append($("#emoji-modal"))}}(this)),(n=e.entity)&&(i=new Maleskine.Report({el:n.find("div.report")}),$("body").scrollTop($("#comments").position().top-100),n.highlight()),this.el.on("ajax:success",function(t){return function(e,r){var i;return-1===r.parent_id?"desc"===$("#comments .comment-head").find("a.active").data("order")?$("#comment-list").prepend(JST.render("comment/entity",r)):$("#comment-list").find(".note-comment:last").length>0?$("#comment-list").find(".note-comment:last").after(JST.render("comment/entity",r)):$("#comment-list").append(JST.render("comment/entity",r)):(t.el.hide(),n=$("#comment-"+r.parent_id),n.data("children-count",(n.data("children-count")||0)+1),n.find("a.reply").removeData("action"),i=n.find(".child-comment-list"),i.find("[data-state=remaining-child-comments]").append(JST.render("comment/child_comment",r)),0===i.find(".comment-toolbar").length&&$(JST.render("comment/footer_metabar",{parentId:r.parent_id})).appendTo(i)),t.el.find("textarea").val(""),t.el.find("span.warning").hide(),t.el.find("span.warning-text").text(""),t.el.find("span.hotkey").show(),$("span.order a:first").hasClass("active")?void 0:$("span.reply-time small").hide()}}(this)),this.el.on("ajax:error",function(t){return function(e,n){return t.el.find("span.hotkey").hide(),t.el.find("span.warning-text").text(n.responseJSON.error),t.el.find("span.warning").show()}}(this))}return n(r,e),r.prototype.elements={textarea:"textarea","input[type=submit]":"commentSubmitButton"},r.prototype.events={"keydown textarea":"submitCommentHotkey"},r.prototype.initAtUsers=function(){return this.textarea.atwho({at:"@",data:JSON.parse($("script[data-name=comment-participants]").html()),limit:10}).atwho({at:":",limit:10,tpl:"<li data-value=':${name}:'><img src='"+Maleskine.Settings.emoji_host+"/assets/emojis/${name}.png' height='20' width='20'/> ${name} </li>",data:Maleskine.Emoji})},r.prototype.initEmojiSet=function(){var t;return this.emojiSet=["smile","blush","smiley","relaxed","wink","heart_eyes","kissing_heart","kissing_closed_eyes","flushed","grin","relieved","stuck_out_tongue_winking_eye","stuck_out_tongue_closed_eyes","unamused","smirk","sweat","pensive","confounded","disappointed_relieved","cold_sweat","fearful","persevere","cry","sob","joy","scream","angry","sleepy","mask","innocent","yum","anguished","frowning","hushed","dizzy_face","stuck_out_tongue","no_mouth","sunglasses","sweat_smile","worried","+1","-1","clap","v","pray","fist","heart","broken_heart","heartbeat","sparkling_heart","cupid","beer","beers","birthday","heavy_exclamation_mark","bangbang","interrobang","underage","no_bicycles","no_mobile_phones","u7981","up","sunny","moon","high_brightness","first_quarter_moon_with_face","zap","snowflake","cloud","tada","bear","cat","cow","dog","hamster","monkey_face","rabbit","tiger","turtle","whale","whale2","dolphin","crocodile","dragon_face","squirrel","hatching_chick","hatched_chick","baby_chick","frog","ant","bug","beetle","ghost","accept","airplane","alarm_clock","ambulance","angel","apple","arrows_counterclockwise","balloon","beginner","bikini","black_nib","blossom","bomb","boom","bow","bread","bulb","cake","cactus","camera","candy","checkered_flag","cherries","cherry_blossom","chocolate_bar","christmas_tree","clapper","closed_umbrella","closed_lock_with_key","clubs","cocktail","coffee","confetti_ball","crown","dancer","dancers","dart","doughnut","first_quarter_moon","fries","game_die","golf","guitar","gun","herb","hibiscus","high_heel","hocho","icecream","ideograph_advantage","jack_o_lantern","key","kiss","lock","lollipop","mag","moneybag","bell","no_bell","ribbon","skull","snowman","spaghetti","sparkles","strawberry","sunflower","sweat_drops","toilet","watermelon","anger","chart","corn","deciduous_tree","dash","dress","ear_of_rice","eyes","fallen_leaf","feet","fishing_pole_and_fish","hankey","heavy_check_mark","leaves","lipstick","mag_right","mailbox_with_mail","mailbox_with_no_mail","man_with_gua_pi_mao","metal","mushroom","musical_keyboard","on","arrow_right","arrow_left","arrow_up","arrow_down","atm","crystal_ball","eight_spoked_asterisk","octocat","crying_cat_face","heart_eyes_cat","joy_cat","scream_cat","smile_cat","smiley_cat","smirk_cat"],this.emojiInitialized=!1,$("#emoji-modal").on("show",function(t){return function(){return t.emojiInitialized?void 0:t.insertEmoji()}}(this)),$("#emoji-modal").on("hidden",function(){return function(t){return $(t.currentTarget).appendTo($("form.new_comment").find("div.emoji"))}}(this)),t=function(){return function(t,e){var n,r,i;return document.selection?(t.focus(),r=document.selection.createRange(),r.text=e):t.selectionStart||"0"===t.selectionStart?(i=t.selectionStart,n=t.selectionEnd,t.value=t.value.substring(0,i)+e+t.value.substring(n,t.value.length),t.selectionStart=n+e.length,t.selectionEnd=n+e.length):t.value+=e}}(this),this.el.on("mousedown","#emoji-modal [data-emoji-name]",function(e){return function(n){var r;return n.preventDefault(),r=" :"+$(n.currentTarget).data("emoji-name")+": ",t(e.el.find("textarea")[0],r),e.el.find("#emoji-modal").modal("hide")}}(this))},r.prototype.insertEmoji=function(){var t,e,n,r,i,o,a,s,l,u,h,c;for(o=$("#emojiTabContent ul"),h=[0,1,2,3],a=0,l=h.length;l>a;a++){for(r=h[a],i=50*r,n=50*(r+1)-1,e="",c=this.emojiSet.slice(i,+n+1||9e9),s=0,u=c.length;u>s;s++)t=c[s],e=""+e+"<li><a href='javascript:void(null)' data-emoji-name='"+t+"'><img src='"+Maleskine.Settings.emoji_host+"/assets/emojis/"+t+".png' alt=':"+t+":' title='"+t+"' class='emoji'></a></li>";$(o[r]).append(e)}return this.emojiInitialized=!0},r.prototype.submitCommentHotkey=function(t){if(Maleskine.BrowserDetector.isMac()){if(t.metaKey&&13===t.keyCode)return this.commentSubmitButton.trigger("click")}else if((10===t.keyCode||13===t.keyCode)&&t.ctrlKey)return this.commentSubmitButton.trigger("click")},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.CommentList=function(e){function r(e){this.initCommentButtons=t(this.initCommentButtons,this),this.initLikeButton=t(this.initLikeButton,this),this.registerLoadChildCommentsEvent=t(this.registerLoadChildCommentsEvent,this),this.registerUndismissEvent=t(this.registerUndismissEvent,this),this.registerDismissEvent=t(this.registerDismissEvent,this),this.registerReplyEvent=t(this.registerReplyEvent,this),this.checkDeleteDismissStatus=t(this.checkDeleteDismissStatus,this),this.loadComments=t(this.loadComments,this),r.__super__.constructor.apply(this,arguments),this.note=e.note,this.noteAuthor=e.author,this.currentUser=e.currentUser,this.loadComments(),this.registerReplyEvent(),this.registerDismissEvent(),this.registerUndismissEvent(),this.registerLoadChildCommentsEvent(),this.el.on("click","[data-action=toggle-child-comments]",function(){return function(t){var e,n;return e=$(t.currentTarget),n=e.closest(".note-comment").find("[data-state=remaining-child-comments]"),n.is(":hidden")?(n.show("slow"),e.html("<i class='fa fa-angle-double-up'></i>"+I18n.t("reading.comment.collapse"))):(n.hide("slow"),e.html("<i class='fa fa-angle-double-down'></i>"+I18n.t("reading.comment.expand")))}}(this)),this.el.on("ajax:success","[data-action=load-comments]",function(t){return function(e,n){return $(e.currentTarget).parent().replaceWith(n),t.initCommentButtons(),"asc"!==$("#comments .comment-head").find("a.active").data("order")&&$("div.meta-top span.reply-time small").hide(),"desc"!==$("#comments .comment-head").find("a.active").data("order")?t.el.find(".note-comment:last").after(t.el.find(".note-comment[data-state=new]")):void 0}}(this)),this.el.on("ajax:success",".pagination a[data-remote]",function(t){return function(e,n){var r,i,o,a;return o=t.el.find(".pagination"),i=o.length>0?o.offset().top:-1,t.el.html(n),t.initCommentButtons(),o=t.el.find(".pagination"),i>=0&&o.length>0&&(a=o.offset().top,r=i-a,Maleskine.BrowserDetector.canScrollManually())?(r=window.scrollY-r,window.scrollTo(window.scrollX,r)):void 0}}(this)),this.el.on("mouseenter",".note-comment,.child-comment",function(){return function(t){return t.stopPropagation(),$(t.currentTarget).find(".report:first").css({display:"inline"})}}(this)),this.el.on("mouseleave",".note-comment,.child-comment",function(t){return function(){return t.el.find(".report").hide()}}(this)),this.el.on("click",".reply-time a",function(t){return function(e){var n,r;return r=$(e.currentTarget).closest(".child-comment,.note-comment").attr("id"),n=$("#"+r),n.length>0?(e.preventDefault(),t.el.find(".highlight").removeClass("highlight"),n.addClass("highlight"),t.scrollToAnchor(r),t.changeBrowserUrl("#"+r,$(e.currentTarget).attr("href")),setTimeout(function(){return t.el.find(".highlight").removeClass("highlight")},2e3)):void 0}}(this)),this.el.on("click",".comment-footer a.like",function(t){return function(e){var n;return Maleskine.isLogined()?(n=$(e.currentTarget),"liked"===n.data("state")?t.unlike(n):t.like(n)):void(location.href=Routes.new_user_session_path())}}(this)),this.el.on("ajax:success",".delete",function(){return function(t,e){var n,r;return $("#comment-"+e.id).hide("slow",function(){return $(this).remove()}),-1!==e.parent_id&&(r=$("#comment-"+e.parent_id),r.data("children-count",r.data("children-count")-1),n=r.find(".child-comment-list"),1===n.find(".child-comment").length)?(n.hide(),n.find(".comment-toolbar").remove()):void 0}}(this)),this.el.on("ajax:error",".delete, .report",function(t){return function(e,n){return t.notyError(n.responseJSON.error)}}(this))}return n(r,e),r.prototype.loadComments=function(){return 1!==this.el.children().length?(this.initCommentButtons(),$(window.location.hash).addClass("highlight"),this.scrollToAnchor($(window.location.hash).attr("id")),setTimeout(function(t){return function(){return t.el.find(".highlight").removeClass("highlight")}}(this),2e3),!1):$.ajax({url:Routes.note_comments_path(this.note.id),dataType:"html"}).done(function(t){return function(e){return t.el.html(e),t.initCommentButtons()}}(this))},r.prototype.checkDeleteDismissStatus=function(){return Maleskine.isLogined()?this.noteAuthor.id===this.currentUser.id?(this.el.find(".delete[data-commenter-id!="+this.currentUser.id+"]").remove(),this.el.find(".dismiss[data-commenter-id="+this.currentUser.id+"]").remove(),this.el.find(".report[data-commenter-id="+this.currentUser.id+"]").remove()):(this.el.find(".dismiss").remove(),this.el.find(".delete[data-commenter-id!="+this.currentUser.id+"]").remove(),this.el.find(".report[data-commenter-id="+this.currentUser.id+"]").remove()):this.el.find(".delete,.dismiss,.report").remove()},r.prototype.registerReplyEvent=function(){return this.el.on("click","a.reply",function(t){return function(e){var n,r,i,o,a;return Maleskine.isLogined()?(r=$(e.currentTarget),n=r.closest(".note-comment"),0===n.find(".new-child-comment").length?(n.find(".child-comment-list").append(JST.render("comment/form",{parentId:r.data("id"),noteId:t.note.id})),a=new Maleskine.CommentForm({el:n.find(".new-child-comment"),emojiInitialized:!0})):n.find(".child-comment-list").append(n.find(".new-child-comment")),i=n.find(".new-child-comment"),"collapse"!==r.data("action")?(n.find(".child-comment-list").is(":hidden")&&n.find(".child-comment-list").show(),n.find(".reply").removeData("action"),i.show(),r.data("action","collapse")):(i.hide(),0===n.find(".child-comment").length&&n.find(".child-comment-list").hide(),r.removeData("action")),o=i.find("textarea"),o.focus(),o.val(null!=r.data("nickname")?"@"+r.data("nickname")+" ":"")):void(location.href=Routes.new_user_session_path())}}(this))},r.prototype.registerDismissEvent=function(){return this.el.on("ajax:success",".dismiss",function(){return function(t,e){var n;return $("#comment-"+e.id).hide("slow"),n="<a href='"+Routes.undismiss_comment_path(e.id)+"' class='undismiss' data-method='post' data-remote='true' data-type='json' rel='nofollow'>"+I18n.t("reading.comment.undismiss_button")+"</a>",noty({text:I18n.t("reading.comment.dismiss_info")+"\u30fb"+n,layout:"topCenter",type:"information",timeout:5500,closeWith:[],theme:"maleskineTheme"})}}(this)),this.el.on("ajax:error",".dismiss",function(t){return function(e,n){return t.notyError($.parseJSON(n.responseText).errors[0])}}(this))},r.prototype.registerUndismissEvent=function(){return $("body").on("ajax:success",".undismiss",function(t){return function(e,n){return $("#comment-"+n.id).show("slow"),$(e.currentTarget).closest("ul").remove(),t.notyInfo(I18n.t("reading.comment.undismiss_info"))}}(this)),$("body").on("ajax:error",".undismiss",function(t){return function(e,n){return t.notyError($.parseJSON(n.responseText).errors[0])}}(this))},r.prototype.registerLoadChildCommentsEvent=function(){return this.el.on("click","a[data-action=load-children-comments]",function(t){return function(e){var n,r,i;return r=$(e.currentTarget),r.hasClass("disabled")?(e.preventDefault(),!1):(n=r.closest(".child-comment-list"),i=n.find(".child-comment").map(function(){return $(this).data("id")}).get(),$.ajax({url:Routes.more_children_comment_path(r.data("id"),{seen_comment_ids:i,max_id:r.data("max-id")}),dataType:"html",method:"get",beforeSend:function(){return r.addClass("disabled")}}).done(function(e){var i;return r.removeClass("disabled"),n.find("[data-state=remaining-child-comments]").append(e),t.checkDeleteDismissStatus(),i=r.closest(".note-comment").data("children-count")-n.find(".child-comment").length,i>0?r.siblings("span.count").text(i):r.parent().html("<a class='blue-link' data-action='toggle-child-comments' href='javascript:void(0) '><i class='fa fa-angle-double-up'></i>"+I18n.t("reading.comment.collapse")+"</a>")}))}}(this))},r.prototype.initLikeButton=function(){var t,e,n,r,i,o;if(Maleskine.isLogined()){for(i=JSON.parse($("script[data-name=comments-info]").html()).liked,o=[],n=0,r=i.length;r>n;n++)e=i[n],t=$("#comment-"+e.id).find(".comment-footer a.like"),t.find("i").attr("class","fa fa-heart"),t.data("state","liked"),o.push(t.data("like_id",e.like_id));return o}},r.prototype.like=function(t){return $.ajax({url:Routes.comment_likes_path($(t).data("id")),method:"post",dataType:"json"}).done(function(){return function(e){return $(t).data("state","liked"),$(t).data("like_id",e.like_id),$(t).find("i").addClass("fa-heart").removeClass("fa-heart-o"),$(t).find("span").html("("+e.likes_count+")")
}}(this))},r.prototype.unlike=function(t){return $.ajax({url:Routes.comment_like_path($(t).data("id"),$(t).data("like_id")),method:"delete",dataType:"json"}).done(function(){return function(e){return $(t).removeData("state"),$(t).removeData("like_id"),$(t).find("i").addClass("fa-heart-o").removeClass("fa-heart"),$(t).find("span").html("("+e.likes_count+")")}}(this))},r.prototype.initCommentButtons=function(){var t,e,n,r,i,o;for(this.initLikeButton(),this.checkDeleteDismissStatus(),n=JSON.parse($("script[data-name=comments-info]").html()),o=n.comments,r=0,i=o.length;i>r;r++)e=o[r],t=$("#comment-"+e.id).find(".comment-footer a.like"),t.find("span").text("("+e.likes_count+")"),$("#comment-"+e.id).data("children-count",e.children_count);return new Maleskine.Report({el:this.el.find("div.report")})},r}(Maleskine.BaseModule)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Maleskine.Report=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.el.find("a[data-toggle='modal']").on("click",function(){return function(t){return $("#report-form").attr("action",$(t.currentTarget).data("url"))}}(this)),this.el.on("ajax:beforeSend","a[data-type]",function(t){return function(){return confirm(I18n.t("reading.abuse_report.confirm"))?void 0:(t.el.removeClass("open"),!1)}}(this)),this.el.on("ajax:success","a[data-type]",function(t){return function(){return t.el.removeClass("open"),t.notyInfo(I18n.t("reading.abuse_report.report_success"))}}(this)),this.el.on("ajax:error","a[data-type]",function(t){return function(e,n){return t.el.removeClass("open"),t.notyError(n.responseJSON.error[0])}}(this))}return e(n,t),n}(Maleskine.BaseModule)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Maleskine.ReportModal=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.el.on("hide.bs.modal",function(t){return function(){return t.reportForm.find("textarea").val(""),t.reportForm.find("#abuse_report_abuse_reportable_id").val(""),t.reportForm.find("#abuse_report_abuse_reportable_type").val("")}}(this)),this.el.on("ajax:beforeSend","form",function(t){return function(){return t.el.find("textarea").val().length<=0?(t.notyError(I18n.t("reading.abuse_report.no_reason")),!1):void 0}}(this)),this.el.on("ajax:error","form",function(t){return function(e,n){return t.el.modal("hide"),t.notyError(n.responseJSON.error[0])}}(this)),this.el.on("ajax:success","form",function(t){return function(){return t.el.modal("hide"),t.notyInfo(I18n.t("reading.abuse_report.report_success"))}}(this))}return e(n,t),n.prototype.elements={"#report-form":"reportForm"},n}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.FurtherReading=function(e){function r(e){this.setFurtherReadingState=t(this.setFurtherReadingState,this),this.hideStateDropdown=t(this.hideStateDropdown,this),this.showStateDropdown=t(this.showStateDropdown,this),this.pasteLoadFurtherLink=t(this.pasteLoadFurtherLink,this),this.enterKeyLoadFurtherLink=t(this.enterKeyLoadFurtherLink,this),this.loadFurtherLink=t(this.loadFurtherLink,this),this.deleteFurtherReading=t(this.deleteFurtherReading,this),this.submitFurtherReading=t(this.submitFurtherReading,this),this.cancelFurtherReading=t(this.cancelFurtherReading,this),this.startNewFurtherReadingLink=t(this.startNewFurtherReadingLink,this),this.initFurtherReadings=t(this.initFurtherReadings,this),r.__super__.constructor.apply(this,arguments),this.note=e.note,this.note||(this.note=JSON.parse($("script[data-name=note]").html())),this.initFurtherReadings()}return n(r,e),r.prototype.elements={"#further-readings-list":"furtherReadingsList","#further-reading-line":"furtherReadingsTitle","#further-reading-description":"furtherReadingDescription"},r.prototype.events={"click #further-reading-new-prompt":"startNewFurtherReadingLink","click #load-further-reading":"loadFurtherLink","click #cancel-further-reading":"cancelFurtherReading","click #submit-further-reading":"submitFurtherReading","click #delete-further-reading":"deleteFurtherReading","keypress #further-reading-link-text":"enterKeyLoadFurtherLink","paste #further-reading-link-text":"pasteLoadFurtherLink","mouseover .further-reading-states>li":"showStateDropdown","mouseout .further-reading-states>li":"hideStateDropdown"},r.prototype.initFurtherReadings=function(){return this.note.has_further_readings&&$.getJSON(Routes.note_further_readings_path(this.note.slug,{format:"json"})).done(function(t){return function(e){var n,r,i,o;if(e.length>0){for(t.furtherReadingsTitle.show(),i=0,o=e.length;o>i;i++)r=e[i],t.furtherReadingsList.append(JST.render("note/further_reading_item",r));if(n=t.getURLParmeter("further_reading"))return t.scrollToAnchor("further_reading_"+n)}}}(this)),this.furtherReadingsList.on("click",".state-item",function(t){return function(e){return t.setFurtherReadingState($(e.currentTarget))}}(this)),$("body").on("click",".undo",function(t){return function(e){var n,r,i;return t.furtherReadingsTitle.show(),i=$(e.currentTarget).data("state"),t.removeFurtherReadingItem&&"dismiss"!==i&&clearTimeout(t.removeFurtherReadingItem),n=$(e.currentTarget).data("further-reading-id"),r=t.furtherReadingsList.find("li#further_reading_"+n),t.setFurtherReadingState(r.find("li[data-state='"+i+"']")),$(e.currentTarget).parents("ul").remove()}}(this))},r.prototype.startNewFurtherReadingLink=function(t){return $(t.currentTarget).hide(),$("#further-reading-form").replaceWith(JST.render("note/further_reading_link")),$("#further-reading-form").show(),this.selectText($("#further-reading-link-text"))},r.prototype.cancelFurtherReading=function(t){return $(t.currentTarget).parent().empty().removeClass("active"),$("#further-reading-new-prompt").show()},r.prototype.submitFurtherReading=function(){var t,e,n;return e=$("#further-reading-title").text(),t=$("#further-reading-description").text(),n=$("#further-reading-url").attr("href"),$.post(Routes.note_further_readings_path(this.note.slug,{format:"json"}),{further_reading:{title:e,description:t,url:n}},function(t){return function(e){return t.furtherReadingsTitle.show(),t.furtherReadingsList.append(JST.render("note/further_reading_item",e)),$("#further-reading-form").empty().removeClass("active"),$("#further-reading-new-prompt").show()}}(this)).fail(function(t){return function(e){return t.notyError($.parseJSON(e.responseText).errors[0])}}(this))},r.prototype.deleteFurtherReading=function(t){var e,n;return n=$(t.currentTarget).parents("li"),e=$(t.currentTarget).data("further-reading-id"),$.ajax({url:Routes.note_further_reading_path(this.note.slug,e,{format:"json"}),type:"DELETE",dataType:"json"}).done(function(t){return function(){return n.remove(),0===t.furtherReadingsList.children().length&&t.furtherReadingsTitle.hide(),t.notyInfo(I18n.t("reading.further_reading.delete_success"))}}(this))},r.prototype.loadFurtherLink=function(){var t;return t=$.trim($("#further-reading-link-text").text()),t.length>0?(/^(http(s?):\/\/|www)/.test(t)||$("#further-reading-link-text").text("http://"+t),$.ajax({url:Routes.external_pages_info_path({url:t}),dataType:"json",beforeSend:function(){return function(){return $("#loader").show()}}(this)}).done(function(t){return function(e){var n,r,i;return i=$("#further-readings").data("user-slug"),r=$("#further-readings").data("user-nickname"),$("#further-reading-form").replaceWith(JST.render("note/further_reading_content",{data:e,slug:i,nickname:r})),n=$("#further-reading-description"),t.selectText(n),n.on("keypress",function(e){var n;return n=e.keyCode||e.which,13===n?t.submitFurtherReading():void 0})}}(this)).fail(function(t){return function(){return t.notyInfo(I18n.t("reading.further_reading.load_link_error"))}}(this)).always(function(){return function(){return $("#loader").hide()}}(this))):void 0},r.prototype.enterKeyLoadFurtherLink=function(t){return 13===t.which?(this.loadFurtherLink(),t.preventDefault()):void 0},r.prototype.pasteLoadFurtherLink=function(){return setTimeout(function(t){return function(){return t.loadFurtherLink()}}(this),100)},r.prototype.showStateDropdown=function(t){return $(t.currentTarget).parent().children().show()},r.prototype.hideStateDropdown=function(t){return $(t.currentTarget).parent().children(".hide").hide()},r.prototype.setFurtherReadingState=function(t){var e,n,r,i,o;return n=t.parents("li"),e=t.parent().data("further-reading-id"),r=n.data("can-be-dismissed"),i=t.parent().data("origin-state"),o=t.data("state"),t.parent().replaceWith(JST.render("note/further_reading_states",{id:e,state:o,can_be_dismissed:r})),n.show(),"dismiss"===o&&(n.hide(),1===this.furtherReadingsList.children().length&&this.furtherReadingsTitle.hide()),$.post(Routes.update_further_reading_state_path({format:"json"}),{note_id:this.note.slug,id:e,state:o},function(t){return function(){var r;return t.removeFurtherReadingItem=setTimeout(function(){return"dismiss"===o?n.remove():void 0},5e3),r=I18n.t("reading.further_reading.states."+o),noty({text:I18n.t("reading.further_reading.undo_link",{state:r,id:e,originState:i}),layout:"topCenter",type:"information",timeout:4800,closeWith:[],theme:"maleskineTheme"})}}(this)).fail(function(t){return function(r){return n.find(".further-reading-states").replaceWith(JST.render("note/further_reading_states",{id:e,state:i})),t.notyError($.parseJSON(r.responseText).errors[0]),"dismiss"===o?(t.furtherReadingsList.children().length>0&&t.furtherReadingsTitle.hide(),n.show()):void 0}}(this))},r.prototype.selectText=function(t){var e,n,r;return e=t[0],document.body.createTextRange?(n=document.body.createTextRange(),n.moveToElementText(e),n.select()):window.getSelection?(r=window.getSelection(),n=document.createRange(),n.selectNodeContents(e),r.removeAllRanges(),r.addRange(n)):void 0},r}(Maleskine.BaseModule)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Maleskine.NoteShow=function(e){function r(){this.checkPayCallback=t(this.checkPayCallback,this),this.wxPubQrHandler=t(this.wxPubQrHandler,this),this.balanceHandler=t(this.balanceHandler,this),this.submitReward=t(this.submitReward,this),this.sortComments=t(this.sortComments,this),this.markNoteRead=t(this.markNoteRead,this),this.markNoteViewed=t(this.markNoteViewed,this),this.loadShareButtons=t(this.loadShareButtons,this),this.loadActivities=t(this.loadActivities,this),this.initTopShareButton=t(this.initTopShareButton,this),this.loadContributeModal=t(this.loadContributeModal,this),this.bindTooltip=t(this.bindTooltip,this),this.customizeMenuHeight=t(this.customizeMenuHeight,this),this.loadCollectionMenu=t(this.loadCollectionMenu,this),this.loadNotebookMenu=t(this.loadNotebookMenu,this);var e,n,i,o,a;r.__super__.constructor.apply(this,arguments),this.shrink.toggleHeader("hide-wrap-btn"),this.wrapbtn.toggleHeader("hide-wrap-btn",".panel"),this.$("[data-toggle=tooltip]").tooltip(),this.note=JSON.parse($("script[data-name=note]").html()),this.author=JSON.parse($("script[data-name=author]").html()),$("script[data-name=reward]").length>0&&(this.reward=JSON.parse($("script[data-name=reward]").html()).rewards),$("script[data-name=current-user]").length>0&&(this.currentUser=JSON.parse($("script[data-name=current-user]").html())),a=$(".author-info .user-stats").find("a"),$(a[0]).find("b").text(this.author.public_notes_count),$(a[1]).find("b").text(this.author.followers_count),$(a[2]).find("b").text(this.author.total_likes_count),/#comments/.test(location.hash)&&(this.goToComment=!0),Maleskine.BrowserDetector.isIE8()&&$(window).width()<=1024&&$(".container").addClass("fix-ie8"),$(window).scroll(function(t){return function(){var e;return e=$(window).scrollTop(),e>200?(t.goTopButton.removeClass("hide-go-top"),t.wrapbtn.css({top:"-1px"})):t.goTopButton.addClass("hide-go-top")}}(this)),this.wordage.text(I18n.t("reading.wordage",{wordage:this.note.wordage})),this.viewsCount.text(I18n.t("reading.views_count",{count:this.note.views_count})),this.likesCount.text(I18n.t("reading.likes_count",{count:this.note.likes_count})),this.commentsCount.text(I18n.t("reading.comments_count",{count:this.note.comments_count})),o=null,this.collectionSearch.userChange(function(t){return function(){return null!==o&&clearTimeout(o),o=setTimeout(function(){var e;return e=t.collectionSearch.val(),$.post(t.collectionSearch.data("search-collections-url")+("&&search_term="+e))},250)}}(this)),this.initAddList(),this.initTopShareButton(),this.startReadingTime=(new Date).getTime(),this.readScrollLimit=this.metaBottom.offset().top,this.markNoteViewed(),n=new Maleskine.FurtherReading({el:this.el.find("#further-readings"),note:this.note}),i=new Maleskine.NoteLike({el:this.el,note:this.note}),this.el.find("#comments form").length>0&&Maleskine.isLogined()&&(e=new Maleskine.CommentForm({el:this.el.find("#comments form")})),this.el.find("#comment-list").length>0&&(this.commentListModule=new Maleskine.CommentList({el:this.el.find("#comment-list"),note:this.note,author:this.author,currentUser:this.currentUser})),this.el.find("div.support-author").length>0&&(this.rewardInfoModule=new Maleskine.RewardInfo({el:this.el.find("div.support-author"),note:this.note,reward:this.reward,current_user:this.currentUser})),setTimeout(function(t){return function(){return t.loadShareButtons()}}(this),1e3),this.initButtonTooltip(),this.contributeModal.on("shown",function(){return $(".add-collection").tooltip("hide")}),this.contributeModal.on("hidden",function(){return $(".add-collection").tooltip("hide")}),this.goToCommentButton.on("click",function(){var t;return t=$(".new_comment").position().top+$(".new_comment").height()+200,$("html, body").animate({scrollTop:t},400),$(".new_comment").find("textarea").focus()}),Maleskine.Utils.generateQRcode($("#share-weixin-modal").find(".modal-body")[0],window.location.href+"?utm_campaign=maleskine&utm_content=note&utm_medium=reader_share&utm_source=weixin")}return n(r,e),r.prototype.elements={"a.go-top":"goTopButton",".wrap-btn":"wrapbtn",".shrink":"shrink","#myModal":"readModeModal",".wordage":"wordage",".views-count":"viewsCount",".comments-count":"commentsCount",".likes-count":"likesCount","#notebooks-menu":"notebooksMenuModal","#collection-menu":"collectionMenuModal","#contribute-modal":"contributeModal","input#search_term":"collectionSearch",".other-article":"otherArticle",".goto-comment":"goToCommentButton",".activities":"activities","div.meta-bottom":"metaBottom","#pay-modal":"rewardModal","#success-pay":"rewardSuccessModal",".support-author>.avatar-list":"rewardItemList"},r.prototype.events={"click .notebooks-menu-btn":"loadNotebookMenu","click .collection-menu-btn":"loadCollectionMenu","show #contribute-modal":"loadContributeModal","click #comments .comment-head .order a":"sortComments","submit form#new_reward":"submitReward"},r.prototype.initButtonTooltip=function(){return $(".add-collection").tooltip({placement:"bottom",title:I18n.t("reading.btn_group.add_to_collection")}),$(".bookmark, .bookmarked").tooltip({placement:"bottom",title:I18n.t("reading.btn_group.bookmark")}),$(".btn-group").find("i.fa-share-square-o").parent().tooltip({placement:"right",title:I18n.t("reading.btn_group.share")})},r.prototype.loadNotebookMenu=function(){return this.notebooksMenuModal.load(Routes.notebook_menu_note_path(this.note.id,{format:"html"}),function(t){return function(){return t.customizeMenuHeight(t.notebooksMenuModal),t.bindTooltip(t.notebooksMenuModal),t.notebooksMenuModal.find("#notebook_menu_note_"+t.note.id).addClass("active")}}(this))},r.prototype.loadCollectionMenu=function(){return this.collectionMenuModal.load(Routes.collection_menu_note_path(this.note.id,{format:"html"}),function(t){return function(){return t.customizeMenuHeight(t.collectionMenuModal),t.bindTooltip(t.collectionMenuModal)}}(this))},r.prototype.customizeMenuHeight=function(t){var e,n;return n=t.find(".panel-heading").outerHeight(),e=$(window).height()-40-n-55,t.find("ul.list-group").css({"max-height":""+e+"px"})},r.prototype.bindTooltip=function(t){return t.find("a.following").tooltip({placement:"left",title:I18n.t("reading.unsubscribe")}),t.find("a.follow").tooltip({placement:"left",title:I18n.t("reading.subscribe")})},r.prototype.loadContributeModal=function(){return $(".modal-body #search_term").val(""),$.getJSON(Routes.editable_collections_user_path(this.currentUser.slug,{note_id:this.note.id,format:"json"}),function(t){return function(e){var n,r;return r=$("ul.add-list"),r&&r.length>0&&r[0]?(r[0].reset=function(){return r.empty().append(JST.render("note/collection",{collections:e.collections,note_id:t.note.id})),r[0].setListItem()},r[0].reset(),n=t.contributeModal.find(".search-query"),n.focus()):void 0}}(this))},r.prototype.initTopShareButton=function(){var t,e,n,r,i,o,a,s;for(t=$("<a href='javascript:void(null)' data-toggle='dropdown' id='top-share-button'><i class='fa fa-share-square-o'></i></a>"),e=$("<ul class='dropdown-menu top-share-dropdown arrow-top'></ul>"),e.append("<li><a data-toggle='modal' href='#share-weixin-modal'><img src='"+Maleskine.CommonImages.social_icon("weixin",32,32)+"'> "+I18n.t("reading.social_sharing.share_to_label.weixin")+"</a></li>"),s=["weibo","tweibo","qzone","twitter","douban","facebook","google_plus","renren"],o=0,a=s.length;a>o;o++)r=s[o],i=$(".meta-bottom").find(".share-group").find("a[data-name="+r+"]").attr("href"),i&&e.append('<li><a href="'+i+"\"><img src='"+Maleskine.CommonImages.social_icon(r,32,32)+"'> "+I18n.t("reading.social_sharing.share_to_label."+r)+"</a></li>");return n=$(".meta-bottom").find(".share-group").find("a[data-name=changweibo]").attr("href"),n&&e.append("<li><a href='"+n+"' target='_blank'><i class='fa fa-arrow-circle-o-down'></i>"+I18n.t("reading.social_sharing.share_to_label.changweibo")+"</a></li>"),$(".editor-article").children("span").append(t).append(e)},r.prototype.initAddList=function(){var t,e,n;return e=-1,n=$("ul.add-list"),n&&n.length>0&&n[0]?(t=function(){return n.find("li.selected").removeClass("selected"),e>-1?$(n.find("li")[e]).addClass("selected"):void 0},n[0].setListItem=function(){var r,i,o,a;for(e=-1,i=n.find("li"),o=0,a=i.length;a>o;o++)r=i[o],r=$(r),r[0]._self=r,r.on("click",function(){return function(t){var e,n;for(e=t.target;"li"!==e.tagName.toLowerCase()&&e.parentElement;)e=e.parentElement;return"li"!==e.tagName.toLowerCase()||e.querySelectorAll("a.delete").length>0||$(e).is(".declined")||$(e).is(".withdrawed")?void 0:(n=e.querySelector("h5"),n.innerHTML=n.innerHTML+'&nbsp;&nbsp;&nbsp;&nbsp;<img alt="Tiny" class="loader-tiny" src="'+Maleskine.CommonImages.loader("tiny")+'" />')}}(this));return t()},this.collectionSearch.on("keydown",function(r){var i,o,a;if(40===r.keyCode||38===r.keyCode||13===r.keyCode)return 13===r.keyCode?(i=n.find("li.selected"),a=i.find("a.delete"),void(a.length>0?a.trigger("click"):i.find("a").trigger("click"))):(o=n.find("li"),38===r.keyCode?(e--,-1>e&&(e=-1)):40===r.keyCode&&(e++,e>=o.length&&(e=-1)),t(),r.preventDefault())})):void 0},r.prototype.loadActivities=function(){return this.activities.load(Routes.activities_note_path(this.note.id,{format:"html"}))},r.prototype.loadShareButtons=function(){return $(".article-share").load(Routes.share_buttons_note_path(this.note.id,{format:"html"}))},r.prototype.markNoteViewed=function(){var t,e,n,r;for(n=/([^&=]+)=?([^&]*)/g,e=window.location.search.slice(1,+window.location.search.length+1||9e9),this.visit_data={},this.visit_data.uuid=JSON.parse($("script[data-name=uuid]").html()).uuid,null!=document.referrer&&document.referrer.length>0&&(this.visit_data.referrer=document.referrer);t=n.exec(e);)("utm_source"===(r=t[1])||"utm_medium"===r||"utm_term"===r||"utm_content"===r||"utm_campaign"===r)&&(this.visit_data[t[1]]=t[2]);return $.post("/notes/"+this.note.slug+"/mark_viewed.json",this.visit_data),null==this.goToComment?$(document).scrollTop()+$(window).height()>=this.readScrollLimit?window.setTimeout(function(t){return function(){return t.markNoteRead()}}(this),1500):$(window).on("scroll.markread",function(t){return function(){return $(document).scrollTop()+$(window).height()>=t.readScrollLimit?($(window).off("scroll.markread"),t.markNoteRead()):void 0}}(this)):void 0},r.prototype.markNoteRead=function(){var t,e;return e=Math.floor(((new Date).getTime()-this.startReadingTime)/1e3),t=this.visit_data,t.reading_time=e,$.post("/notes/"+this.note.slug+"/mark_read.json",t)},r.prototype.sortComments=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),$.ajax({url:Routes.note_comments_path(this.note.id,{order:e.data("order")}),dataType:"html",beforeSend:function(){return $("#comment-list").html("<img class='loader-tiny' src='http://baijii-common.b0.upaiyun.com/loaders/tiny.gif' alt='Tiny'>")}}).done(function(t){return function(n){return $("#comment-list").html(n),"asc"!==e.data("order")&&$("div.meta-top span.reply-time small").hide(),e.siblings().removeClass("active"),e.addClass("active"),t.commentListModule.initCommentButtons()}}(this))},r.prototype.submitReward=function(t){var e,n,r,i;if(e=$(t.currentTarget),n=e.find("button[type=submit]"),r=e.find("#reward_amount_in_yuan").val(),i=e.find(":radio:checked").val(),!$.isNumeric(r)||parseFloat(r)<1)return this.notyError(I18n.t("reading.rewards.amount_less_than_zero")),t.preventDefault(),!1;if(parseFloat(r)>=1e4)return this.notyError(I18n.t("reading.rewards.amount_greater_than_maximum")),t.preventDefault(),!1;if("wx_pub_qr"===i&&parseFloat(r)>200)return this.notyError(I18n.t("reading.rewards.amount_greater_than_limit")),t.preventDefault(),!1;if("balance"===i&&100*parseFloat(r)>this.currentUser.balance_in_cent)return this.notyError(I18n.t("reading.rewards.amount_greater_than_balance")),t.preventDefault(),!1;switch(i){case"alipay":if(this.rewardModal.modal("hide"),this.rewardSuccessModal.modal("show"),null!=this.currentUser)return this.rewardItemList.prepend(JST.render("note/reward_item",{current_user:this.currentUser,now:new Date})),this.rewardInfoModule.initRewardTooltip();break;case"balance":case"wx_pub_qr":return t.preventDefault(),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"json",beforeSend:function(){return n.prop("disabled",!0),n.html('<i class="fa fa-spinner fa-pulse"></i>')}}).done(function(t){return function(e){return"wx_pub_qr"===i?t.wxPubQrHandler(e):t.balanceHandler()}}(this)).fail(function(t){return function(e){return t.notyError(e.responseJSON.error)}}(this)).always(function(){return function(){return n.removeProp("disabled"),n.html(I18n.t("reading.rewards.pay_now"))}}(this))}},r.prototype.balanceHandler=function(){return this.rewardModal.modal("hide"),this.rewardSuccessModal.modal("show"),null!=this.currentUser?(this.rewardItemList.prepend(JST.render("note/reward_item",{current_user:this.currentUser,now:new Date})),this.rewardInfoModule.initRewardTooltip()):void 0},r.prototype.wxPubQrHandler=function(t){return this.rewardModal.modal("hide"),this.rewardModal.after(JST.render("rewards/wx_pub_qr_pay",{amount:this.rewardModal.find("#reward_amount_in_yuan").val()})),Maleskine.Utils.generateQRcode($("#wx-pub-qr-pay-modal").find(".modal-body")[0],t.wx_pub_qr),$("#wx-pub-qr-pay-modal").modal("show"),this.rewardChargeId=t.charge_id,this.rewardInterval=setInterval(this.checkPayCallback,1500)},r.prototype.checkPayCallback=function(){return $.get(Routes.pingpp_charge_path(this.rewardChargeId),function(t){return function(e){return e.paid&&(clearInterval(t.rewardInterval),t.rewardChargeId=null,$("#wx-pub-qr-pay-modal").modal("hide"),t.rewardSuccessModal.modal("show"),null!=t.currentUser)?(t.rewardItemList.prepend(JST.render("note/reward_item",{current_user:t.currentUser,now:new Date})),t.rewardInfoModule.initRewardTooltip()):void 0}}(this))},r}(Maleskine.BaseModule)}.call(this);