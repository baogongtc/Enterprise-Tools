clouda.define("mbaas/account",function(o){var i=clouda.lightapp,n=clouda.mbaas.account={},o=clouda.mbaas||{},e=clouda.DelegateClass,a=clouda.kuangForReady,t=(clouda.runtimeError,clouda.installPlugin,clouda.cloudaBLight),c=(new e("device","login","login"),null);o.LOGIN_TYPE={WEIBO:"sinaweibo",QQ:"qqdenglu",KAIXIN:"kaixin",QQWEIBO:"qqweibo",RENREN:"renren"};var l=!1,u=clouda.lib.utils.stat,r=function(o){var i={client_id:clouda.lightapp.ak,redirect_uri:o.redirect_uri,scope:o.scope||"basic",login_mode:o.login_mode||0,login_type:o.login_type||void 0,mobile:o.mobile||void 0,display:"mobile",response_type:"code",state:o.state||void 0};return 1===i.login_mode&&(i.confirm_login=1),2===i.login_mode&&(i.force_login=1),i.disable_third_login=0===o.disable_third_login?o.disable_third_login:1,o.authorize_url&&(i.authorize_url=o.authorize_url),o.ak&&(i.ak=o.ak),i},d=function(o){var i="https://openapi.baidu.com/oauth/2.0/authorize",n=o.ak||clouda.lightapp.ak;o.authorize_url&&(i=o.authorize_url);var e=i+"?response_type=code&client_id="+n+"&redirect_uri="+encodeURIComponent(o.redirect_uri);return o.login_mode&&(e+="&login_mode="+o.login_mode),o.login_type&&(e+="&login_type="+o.login_type),o.scope&&(e+="&scope="+o.scope),o.state&&(e+="&state="+o.state),o.display&&(e+="&display="+o.display),o.force_login&&(e+="&force_login="+o.force_login),o.confirm_login&&(e+="&confirm_login="+o.confirm_login),o.mobile&&(e+="&mobile="+o.mobile),o.return_callback&&(e+="&return_callback="+encodeURIComponent(location.origin)),e+="&disable_third_login="+o.disable_third_login},s=function(o,i){var n=document.createElement("script");n.setAttribute("src",o),document.head.appendChild(n),n.onload=function(){i&&i(n)}},p=function(o){window.openapiCheckLoginCallback=function(i){o(i)};var i="//openapi.baidu.com/widget/social/login?format=jsonp&callback=openapiCheckLoginCallback";s(i,function(o){document.head.removeChild(o)})};n.login=function(o){function i(){n.return_callback=1;var i=d(n);document.querySelector("#cloudaLoginFrame")?c=document.querySelector("#cloudaLoginFrame"):(c=document.createElement("iframe"),c.id="cloudaLoginFrame"),c.src=i,c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.scrolling="no",c.style.border="none",c.style.backgroundColor="#fff",c.style.display="none",c.style.zIndex="99999",document.body.appendChild(c),l||window.addEventListener("message",function(i){var n=i.data;"return_callback"===n&&(clouda.mbaas.account.closeLoginDialog(),o.onfail()),"show_login"===n&&(c.style.display="block"),l=!0},!1);var e=top.innerWidth>=top.document.body.offsetHeight?top.innerWidth:top.document.body.offsetHeight;c.style.width=top.innerWidth+"px",c.style.height=e+"px",c.onload=function(){c.style.width=top.innerWidth+"px",c.style.height=e+"px"}}if(!o.redirect_uri)return console.error("missing redirect_uri"),!1;var n=r(o);if(!o.onsuccess||!o.onfail){var e=d(n);if(clouda.RUNTIME==clouda.RUNTIMES.KUANG&&"function"==typeof BLightApp.isLogin)return clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION<"6.4"?(u({api:"account.login",runtime:"web"}),void(location.href=e)):(u({api:"account.login",runtime:"kuang"}),void t("isLogin",JSON.stringify({}),function(o){if("0"!=o.isLogin&&o.isLogin)location.href=e;else{n.tpl="clouda";var i=clouda.lib.utils.regcallback(function(){location.href=e},function(){});BLightApp.bdLogin(JSON.stringify(n),i.s,i.f)}},function(){location.href=e}));if(clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION>="6.7"&&clouda.RUNTIME_VERSION<"6.8"&&navigator.userAgent.match(/baiduboxapp/i)){n.tpl="clouda",n.redirect_uri="";var a=clouda.lib.utils.regcallback(function(){location.href=e},function(){});return u({api:"account.login",runtime:"kuang"}),void p(function(o){location.href=o.uid?e:"baiduboxapp://account?action=logindialog&successcallback="+encodeURIComponent(a.s)+"&failcallback="+encodeURIComponent(a.f)+"&params="+JSON.stringify(n)+"&minver=5.5.0.0"})}return clouda.RUNTIME===clouda.RUNTIMES.LIGHTSDK?void clouda.lightsdk(function(o){return o.isLogin?void(location.href=e):(u({api:"account.login",runtime:"o2o"}),void clouda.lightsdk(function(){location.href=e},function(){},"device.account","login",{}))},function(){location.href=e},"device.account","isLogin",{}):(u({api:"account.login",runtime:"web"}),void(location.href=e))}if(!Boolean(o.force_h5)&&clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.login){var a=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);BLightApp.login(JSON.stringify(n),a.s,a.f)}else clouda.RUNTIME===clouda.RUNTIMES.LIGHTSDK?clouda.lightsdk(function(o){return o.isLogin?void i():void clouda.lightsdk(function(){i()},function(){},"device.account","login",{})},function(){location.href=e},"device.account","isLogin",{}):i()},n.closeLoginDialog=function(){c&&document.body.contains(c)&&document.body.removeChild(c)},n.bdLogin=function(o){if(!o.onsuccess||!o.onfail||"function"!=typeof o.onsuccess||"function"!=typeof o.onfail||!o.tpl)return i.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,o),!1;var n={};if(n.u=o.u?encodeURIComponent(o.u):"",n.uid=o.uid||"",n.regtype=o.regtype||"",n.from=o.from||"",n.bd_page_type=o.bd_page_type||"",n.pu=o.pu||"",n.tn=o.tn||"",n.tpl=o.tpl,n.login_type=o.login_type||"",n.mobile=o.mobile||"",n.sms="sms"==n.login_type?1:0,clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION>="6.7"&&clouda.RUNTIME_VERSION<"6.8"&&navigator.userAgent.match(/baiduboxapp/i)){u({api:"account.bdLogin",runtime:"kuang"});var e=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);return void(location.href="baiduboxapp://account?action=logindialog&successcallback="+encodeURIComponent(e.s)+"&failcallback="+encodeURIComponent(e.f)+"&params="+JSON.stringify(n)+"&minver=5.5.0.0")}if(!clouda.STATUS.SUCCESS)return void a("clouda.mbaas.account.bdLogin",arguments);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.bdLogin){u({api:"account.bdLogin",runtime:"kuang"});var e=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);return void BLightApp.bdLogin(JSON.stringify(n),e.s,e.f)}if(clouda.RUNTIME===clouda.RUNTIMES.LIGHTSDK)return u({api:"account.bdLogin",runtime:"o2o"}),void clouda.lightsdk(o.onsuccess,o.onfail,"device.account","login",{});if("undefined"!=typeof uix_bridge){u({api:"account.bdLogin",runtime:"uix"});var e=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);return void uix_bridge.bdLogin(JSON.stringify(o),e.s,e.f)}var t="http://wappass.baidu.com/passport/",c=t+"?login&smsLoginLink=1&sms="+n.sms+"&adapter=2&u="+n.u+"&uid="+n.uid+"&pu="+n.pu+"&regtype="+n.regtype+"&from="+n.from+"&bd_page_type="+n.bd_page_type+"&tn="+n.tn+"&tpl="+n.tpl;if(u({api:"account.bdLogin",runtime:"web"}),o.extra_params){var l=o.extra_params;for(var r in l)l.hasOwnProperty(r)&&(c=c+"&"+r+"="+l[r])}return void(1==o.noReplace?location.href=c:location.replace(c))}});
;clouda.define("mbaas/pay",function(){var a=clouda.lightapp,o=clouda.mbaas.pay={},i=(clouda.mbaas||{},clouda.DelegateClass),n=clouda.kuangForReady,e=(clouda.runtimeError,clouda.installPlugin,clouda.cloudaBLight),r=(new i("lightpay","init"),new i("lightpay","dopay"),["lecai.com","cloudaapi.duapp.com"]),d=clouda.lib.utils.stat;o.init=function(o,i){if(!o)return a.error(ErrCode.UNKNOW_INPUT,ErrCode.UNKNOW_INPUT,i),!1;if("number"==typeof o&&(o=String(o)),!clouda.STATUS.SUCCESS)return void n("clouda.mbaas.pay.init",arguments);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.initpay){d({api:"pay.init",runtime:"kuang"});var e=clouda.lib.utils.regcallback(function(){i.onsuccess(clouda.STATUS.SUCCESS)},i.onfail);return BLightApp.initpay(e.s,e.f,o),!1}clouda.RUNTIME===clouda.RUNTIMES.NUWA},o.doPay=function(o){if(o.hideLoading||(o.hideLoading=!1),o.orderInfo||a.error(ErrCode.PAY_ERROR,ErrCode.UNKNOW_INPUT,o),clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION>="6.7"&&clouda.RUNTIME_VERSION<"6.9"&&navigator.userAgent.match(/baiduboxapp/i)){d({api:"pay.doPay",runtime:"kuang"});var i=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);return location.href="baiduboxapp://dopay?action=dopay&hideLoadingDialog="+(o.hideLoading?1:0)+"&successcallback="+encodeURIComponent(i.s)+"&failcallback="+encodeURIComponent(i.f)+"&orderinfo="+o.orderInfo+"&minver=5.3.0.0",!1}if(!clouda.STATUS.SUCCESS)return void n("clouda.mbaas.pay.doPay",arguments);if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&BLightApp&&"function"==typeof BLightApp.dopay){d({api:"pay.doPay",runtime:"kuang"});var i=clouda.lib.utils.regcallback(o.onsuccess,o.onfail);if(clouda.PLATFORM===clouda.PLATFORMS.IOS){for(var e=o.safari?!0:!1,t=0,c=r.length;c>t;t++)if(-1!==location.origin.indexOf(r[t])){e=!0;break}if(e){if(clouda.RUNTIME_VERSION>"5.3.5"){var l={ExternalURL:"http://baifubao.baidu.com/jump?uri=/api/0/pay/0/wapdirect/0&"+o.orderInfo};BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading,JSON.stringify(l))}else BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading);return}}return BLightApp.dopay(i.s,i.f,o.orderInfo,o.hideLoading),!1}return clouda.RUNTIME===clouda.RUNTIMES.LIGHTSDK?(d({api:"pay.doPay",runtime:"o2o"}),void clouda.lightsdk(function(a){o.onsuccess(a.replace(/;$/,""))},function(a){o.onfail(a.error_info.replace(/;$/,""))},"device.pay","dopay",o)):(d({api:"pay.doPay",runtime:"web"}),1==o.noLogin?(location.href="https://wallet.baidu.com/api/0/pay/0/wapdirect?"+o.orderInfo,!1):1==o.coin_trans_type?(location.href="https://wallet.baidu.com/api/0/pay/0/waptransfer/0?"+o.orderInfo,!1):(location.href="https://wallet.baidu.com/api/0/pay/0/wap/0/cashdesk/0?"+o.orderInfo,!1))},o.doPolymerPay=function(a){var o=a.sdk_orderInfo||a.orderInfo,i=(a.h5_orderInfo||a.orderInfo,function(a){for(var o,i,n={},e=a.split("&"),r=0,d=e.length;d>r;r++)tmp=e[r].split("="),o=tmp[0],i=tmp[1],o&&(n[o]=decodeURIComponent(i));return n});if(clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION>="6.5"&&clouda.RUNTIME_VERSION<"6.9"&&navigator.userAgent.match(/baiduboxapp/i)){d({api:"pay.doPolymerPay",runtime:"kuang"});var n=i(o),r=encodeURIComponent(JSON.stringify(n)||""),t=clouda.lib.utils.regcallback(a.onsuccess,a.onfail);return void(location.href="baiduboxapp://bdwallet?action=doPolymerPay&successcallback="+encodeURIComponent(t.s)+"&failcallback="+encodeURIComponent(t.f)+"&params="+r+"&minver=5.3.0.0")}if(clouda.RUNTIME===clouda.RUNTIMES.KUANG&&"function"==typeof BLightApp.doPolymerPay){d({api:"pay.doPolymerPay",runtime:"kuang"});var n=i(o);return void e("doPolymerPay",JSON.stringify(n),a.onsuccess,a.onfail)}d({api:"pay.doPolymerPay",runtime:"web"});var c="https://zhifu.baidu.com/proxy/req/newcashier?";return void(location.href=c+a.h5_orderInfo)},o.payCode=function(){return clouda.PLATFORM===clouda.PLATFORMS.ANDROID&&clouda.RUNTIME_VERSION>="6.3"&&"6.8"!==clouda.RUNTIME_VERSION.substring(0,3)&&navigator.userAgent.match(/baiduboxapp/i)?(d({api:"pay.payCode",runtime:"kuang"}),void Box.android.invokeApp("Bdbox_android_utils","command",[JSON.stringify({intent:"intent:#Intent;action=com.baidu.searchbox.wallet.action.WALLET_VIEW;l.service_id=512;end",mode:"0"})])):clouda.PLATFORM===clouda.PLATFORMS.IOS&&clouda.RUNTIME_VERSION>="6.3"&&navigator.userAgent.match(/baiduboxapp/i)?(d({api:"pay.payCode",runtime:"kuang"}),void(location.href="baiduboxapp://wallet?type=5")):(d({api:"pay.payCode",runtime:"web"}),void(location.href="https://wallet.baidu.com/content/mywallet/o2o/b2c/index.html"))}});